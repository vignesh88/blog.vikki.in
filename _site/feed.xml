<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.0.1">Jekyll</generator><link href="https://www.vikki.in/feed.xml" rel="self" type="application/atom+xml" /><link href="https://www.vikki.in/" rel="alternate" type="text/html" /><updated>2020-08-01T12:56:26+05:30</updated><id>https://www.vikki.in/feed.xml</id><title type="html">Vikki’s blog</title><subtitle>My blog on Linux, Opensource, Electronics and Photography</subtitle><author><name>Vignesh Ragupathy</name></author><entry><title type="html">Publish package in NPM and serve the static content from CDN</title><link href="https://www.vikki.in/publish-package-in-npm-and-serve-the-static-content-from-cdn/" rel="alternate" type="text/html" title="Publish package in NPM and serve the static content from CDN" /><published>2020-06-12T12:15:00+05:30</published><updated>2020-06-12T12:15:00+05:30</updated><id>https://www.vikki.in/publish-package-in-npm-and-serve-the-static-content-from-cdn</id><content type="html" xml:base="https://www.vikki.in/publish-package-in-npm-and-serve-the-static-content-from-cdn/">&lt;p&gt;&lt;img src=&quot;/content/images/cover/npm.jpg&quot; alt=&quot;&quot; /&gt;
&lt;em&gt;Photo by &lt;a href=&quot;https://photography.vikki.in/vikki-photography-budapest-3&quot; target=&quot;_blank&quot;&gt;Vignesh Ragupathy&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;I have been utilizing AWS to host my personal blog for almost 3 years now. Originally my blog was hosted in WordPress and then I migrated to &lt;a href=&quot;https://ghost.org/&quot; target=&quot;_blank&quot;&gt;ghost&lt;/a&gt;. It’s been 2 years now in ghost and I thought of exploring a new hosting option which should be free, supports custom domain name and free &lt;a href=&quot;https://letsencrypt.org/&quot; target=&quot;_blank&quot;&gt;SSL&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jekyllrb.com/&quot; target=&quot;_blank&quot;&gt;Jekyll&lt;/a&gt; is a ruby based static blog generator and it has an advantage of free hosting in GitHub. The letsencrypt SSL certificate is also provided by GitHub for my custom domain so i don’t have to worry about managing it.&lt;/p&gt;

&lt;p&gt;I also created a separate &lt;a href=&quot;https://tools.vikki.in&quot; target=&quot;_blank&quot;&gt;website&lt;/a&gt; to showcase my open-source tools and I can use the same AWS instance for hosting it. It is a Django application which uses more memory/CPU, so i can run it in a dedicated instance instead of running the ghost and Django together.&lt;/p&gt;

&lt;p&gt;One of the challenges in a Django application is hosting your static content. Django recommends using a proxy server like Nginx to serve its static content.&lt;/p&gt;

&lt;p&gt;I use my nginx proxy to serve the static content. But due to performance reason , i started to explore the free CDN to serve my static content&lt;/p&gt;

&lt;p&gt;Below is the nginx configuration snippet for mapping static content.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;location /static/ {
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;        root /tools.vikki.in/static;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;go&quot;&gt;    }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;After doing some research I chose to utilize unpkg or jsdelivr for my site.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;unpkg and jsdelivr are global CDN and they can be used to deliver any packages hosted in NPM&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://unpkg.com/&quot; target=&quot;_blank&quot;&gt;unpkg&lt;/a&gt; and &lt;a href=&quot;https://www.jsdelivr.com/&quot; target=&quot;_blank&quot;&gt;jsdelivr&lt;/a&gt; both provides CDN for the content hosted in NPM.
So first we should have the static content published in &lt;a href=&quot;https://www.npmjs.com/&quot; target=&quot;_blank&quot;&gt;NPM&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;npm-package-creation&quot;&gt;NPM Package creation&lt;/h2&gt;

&lt;h3 id=&quot;1-create-the-directory-for-adding-packages-for-npm&quot;&gt;1. Create the directory for adding packages for NPM&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;mkdir npm
mkdir npm/dist
cd npm&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;2-create-a-packagejson-file-for-your-package&quot;&gt;2. Create a package.json file for your package&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;npm init&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sensible defaults.

See `npm help json` for definitive documentation on these fields
and exactly what they do.

Use `npm install pkg` afterwards to install a package and
save it as a dependency in the package.json file.

Press ^C at any time to quit.
package name: (npm) vikki-tools
version: (1.0.0) 1.0.7
description: Libraries for https://tools.vikki.in
entry point: (index.js) dist/index.js
test command:
git repository: https://github.com/vignesh88/tools.git
keywords: vikki, tools
author: Vignesh Ragupathy
license: (ISC)
About to write to /home/vikki/npm/package.json:&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;vikki-tools&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1.0.7&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Libraries for https://tools.vikki.in&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;main&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dist/index.js&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;echo &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Error: no test specified&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &amp;amp;&amp;amp; exit 1&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;repository&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;git&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;url&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;git+https://github.com/vignesh88/tools.git&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;keywords&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;vikki&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tools&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;author&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Vignesh Ragupathy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;license&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ISC&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;bugs&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;url&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;https://github.com/vignesh88/tools/issues&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;homepage&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;https://github.com/vignesh88/tools#readme&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;Is this OK? (yes) yes&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-create-a-indexjs&quot;&gt;3. Create a index.js&lt;/h3&gt;

&lt;p&gt;I added a javascript function that will be used to copy text to clipboard.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;vim dist/index.js&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;copyToClipboard&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data_2_copy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data_2_copy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;innerText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;textarea&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;opacity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fixed&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;textContent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data_2_copy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getElementsByTagName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;execCommand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;copy&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;removeChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;err&quot;&gt; &lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;4-copy-all-your-static-content-to-dist-directory&quot;&gt;4. Copy all your static content to dist directory&lt;/h3&gt;

&lt;p&gt;Now lets copy all our static content to the &lt;mark&gt;dist&lt;/mark&gt; directory.
I have various css,images,javascript that will be used in various app inside my django application.&lt;/p&gt;

&lt;p&gt;Below are the files which i copied.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;tree .
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;.
&lt;/span&gt;&lt;span class=&quot;go&quot;&gt;├── dist
│   ├── admin
│   │   ├── css
│   │   │   ├── autocomplete.css
│   │   │   ├── base.css
│   ├── geoip
│   │   ├── css
│   │   │   ├── geoip_dark.css
│   │   │   └── geoip_light.css
│   │   └── js
│   │       └── geoip.js
│   ├── index.js
│   └── password_generator
│       ├── css
│       │   ├── password_generator_dark.css
│       │   └── password_generator_light.css
│       ├── img
│       │   ├── copy-full.svg
│       │   └── regenerate.svg
│       └── js
│           └── password_generator.js
├── package.json
└── README.md&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;5-publish-you-static-content-as-package-in-npm&quot;&gt;5. Publish you static content as package in NPM&lt;/h3&gt;

&lt;p&gt;Now we are all set, let’s connect to NPM and publish our package.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;You should already have an account in NPM to publish.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;npm login
Username: r_vignesh
Password: 
Email: (this IS public) me@vikki.in
Logged in as r_vignesh on https://registry.npmjs.org/.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;npm publish

npm notice
npm notice package: vikki-tools@1.0.7
npm notice === Tarball Contents ===
npm notice 1.1kB   dist/admin/img/LICENSE
npm notice 8.4kB   dist/admin/css/autocomplete.css
npm notice 16.4kB  dist/admin/css/base.css
npm notice 698B    dist/base64/css/base64_dark.css
npm notice 159B    dist/base64/css/base64_light.css
npm notice 85.9kB  dist/admin/fonts/Roboto-Regular-webfont.woff
npm notice === Tarball Details ===
npm notice name:          vikki-tools
npm notice version:       1.0.7
npm notice package size:  1.1 MB
npm notice unpacked size: 3.9 MB
npm notice shasum:        a9153c3a9bb68bc34d5040d2088a5b95a256e4cc
npm notice integrity:     sha512-zynWl1/pL0Wvk[...]k3yhkCzBz7+0A==
npm notice total files:   188
npm notice
+ vikki-tools@1.0.7&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;That’s it. Now we have the package published in NPM.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Unpkg and Jsdelivr provide CDN for NPM packages without any configuration.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;6-verify-published-package-in-npm&quot;&gt;6. Verify published package in NPM&lt;/h3&gt;

&lt;p&gt;Lets try to access it using unpkg. Open your browser and enter the url in the below format.&lt;/p&gt;

&lt;p&gt;&lt;mark&gt;https://unpkg.com/pacakage/&lt;/mark&gt;&lt;/p&gt;

&lt;p&gt;For using specific version &lt;mark&gt;https://unpkg.com/package@version/:file&lt;/mark&gt;&lt;/p&gt;

&lt;p&gt;My package name is &lt;em&gt;vikki-tools&lt;/em&gt; so the format will be &lt;a href=&quot;https://unpkg.com/vikki-tools/&quot; target=&quot;_blank&quot;&gt;https://unpkg.com/vikki-tools&lt;mark&gt;/&lt;/mark&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The leading &lt;mark&gt; / &lt;/mark&gt; at the end of the URL is important.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;screenshot-from-browser&quot;&gt;Screenshot from browser&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/content/images/2020/screenshot_vikki_tools.jpg&quot; alt=&quot;unpkg screenshot&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;using-unpkg-to-serve-static-content-in-website&quot;&gt;Using Unpkg to serve static content in website&lt;/h2&gt;

&lt;p&gt;We can now load the static content from NPM on our website.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://unpkg.com/vikki-tools@1.0.3/dist/index.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://unpkg.com/vikki-tools@1.0.3/dist/base64/css/base64_dark.css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;using-jsdelivr-to-serve-static-content-in-website&quot;&gt;Using Jsdelivr to serve static content in website&lt;/h2&gt;

&lt;p&gt;We can also use Jsdelivr instead of unpkg.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://cdn.jsdelivr.net/npm/vikki-tools@1.0.3/dist/index.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://cdn.jsdelivr.net/npm/vikki-tools@1.0.3/dist/base64/css/base64_dark.css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;auto-minified-version-from-jsdelivr&quot;&gt;Auto minified version from jsdelivr&lt;/h2&gt;

&lt;p&gt;Jsdelivr also provides the auto minified version of the CSS and Javascript from NPM.
If you want to use minified version css and js, just add &lt;mark&gt;.min&lt;/mark&gt; extension to the filename&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://cdn.jsdelivr.net/npm/vikki-tools@1.0.3/dist/index.min.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://cdn.jsdelivr.net/npm/vikki-tools@1.0.3/dist/base64/css/base64_dark.min.css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;script-to-automatically-update-the-static-and-cdn-url-in-django&quot;&gt;Script to automatically update the static and CDN URL in Django&lt;/h2&gt;

&lt;p&gt;For ease, I created a script to automatically update all static content in your template directory in the Django application.&lt;/p&gt;

&lt;p&gt;The code is available in the &lt;a href=&quot;https://github.com/vignesh88/tools/blob/master/vikki_scripts/django_template_static_to_cdn.py&quot; target=&quot;_blank&quot;&gt;Github URL&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;demo-video&quot;&gt;Demo video&lt;/h2&gt;

&lt;style&gt;.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }&lt;/style&gt;
&lt;div class=&quot;embed-container&quot;&gt;&lt;iframe src=&quot;https://www.youtube.com/embed/PKGLkmzHQH0&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;

&lt;!--
&lt;object style=&quot;width:100%;height:100%;width: 820px; height: 461.25px; float: none; clear: both; margin: 2px auto;&quot; data=&quot;https://www.youtube.com/embed/XMSV5J4jxSo&quot;&gt;
&lt;/object&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/XMSV5J4jxSo&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen&gt;&lt;/iframe&gt;
--&gt;</content><author><name>Vignesh Ragupathy</name></author><category term="linux" /><category term="opensource" /><summary type="html">Photo by Vignesh Ragupathy.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://www.vikki.in/content/images/cover/npm.jpg" /><media:content medium="image" url="https://www.vikki.in/content/images/cover/npm.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Backup of etcd database in kubernetes</title><link href="https://www.vikki.in/backup-of-etcd-database-in-kubernetes/" rel="alternate" type="text/html" title="Backup of etcd database in kubernetes" /><published>2019-11-28T16:37:26+05:30</published><updated>2019-11-28T16:37:26+05:30</updated><id>https://www.vikki.in/backup-of-etcd-database-in-kubernetes</id><content type="html" xml:base="https://www.vikki.in/backup-of-etcd-database-in-kubernetes/">&lt;p&gt;Kubernetes cluster state is saved in etcd datastore. In the post we are going to see how to take a backup for etcd database in kubernetes cluster.&lt;/p&gt;

&lt;h3 id=&quot;setup&quot;&gt;&lt;strong&gt;Setup&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.&lt;/p&gt;

&lt;!--kg-card-begin: image--&gt;
&lt;figure class=&quot;kg-card kg-image-card&quot;&gt;&lt;img src=&quot;/content/images/2019/11/setup-7.jpg&quot; class=&quot;kg-image&quot; /&gt;&lt;/figure&gt;
&lt;!--kg-card-end: image--&gt;
&lt;h5 id=&quot;step-1-create-a-directory-and-backup-all-certificates&quot;&gt;Step 1: Create a directory and backup all certificates&lt;/h5&gt;

&lt;p&gt;Kubernetes cluster have all the certificates saved in the defautl path /etc/kubernetes/pki. Take the backup of all the files and save it in the backup directory&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mkdir &lt;/span&gt;backup 
&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;backup/&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/backup$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo cp&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-rvf&lt;/span&gt; /etc/kubernetes/pki &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/ca.key' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/ca.key'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/ca.crt' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/ca.crt'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/apiserver.key' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/apiserver.key'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/apiserver.crt' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/apiserver.crt'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/apiserver-kubelet-client.key' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/apiserver-kubelet-client.key'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/apiserver-kubelet-client.crt' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/apiserver-kubelet-client.crt'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/front-proxy-ca.key' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/front-proxy-ca.key'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/front-proxy-ca.crt' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/front-proxy-ca.crt'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/front-proxy-client.key' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/front-proxy-client.key'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/front-proxy-client.crt' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/front-proxy-client.crt'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/etcd' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/etcd'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/etcd/ca.key' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/etcd/ca.key'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/etcd/ca.crt' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/etcd/ca.crt'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/etcd/server.key' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/etcd/server.key'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/etcd/server.crt' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/etcd/server.crt'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/etcd/peer.key' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/etcd/peer.key'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/etcd/peer.crt' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/etcd/peer.crt'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/etcd/healthcheck-client.key' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/etcd/healthcheck-client.key'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/etcd/healthcheck-client.crt' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/etcd/healthcheck-client.crt'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/apiserver-etcd-client.key' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/apiserver-etcd-client.key'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/apiserver-etcd-client.crt' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/apiserver-etcd-client.crt'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/sa.key' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/sa.key'&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;'/etc/kubernetes/pki/sa.pub' -&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'./pki/sa.pub'&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;    &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-2-download-the-etcdctl-binary&quot;&gt;Step 2: Download the etcdctl binary&lt;/h5&gt;

&lt;p&gt;Download the etcdctl binary. I have created a shortlinks for the etcd-v3.2.28 which works in ubuntu16.04 and kubernetes v16.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/backup$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;wget shortlinks.vikki.in/etcd
&lt;span class=&quot;go&quot;&gt;--2019-11-26 22:05:52-- http://shortlinks.vikki.in/etcd
Resolving shortlinks.vikki.in (shortlinks.vikki.in)... 172.217.160.179, 2404:6800:4007:80d::2013
Connecting to shortlinks.vikki.in (shortlinks.vikki.in)|172.217.160.179|:80... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://github.com/vignesh88/blog/raw/master/kubernetes/etcd/etcd-v3.2.28-linux-amd64.tar.gz [following]
--2019-11-26 22:05:53-- https://github.com/vignesh88/blog/raw/master/kubernetes/etcd/etcd-v3.2.28-linux-amd64.tar.gz
Resolving github.com (github.com)... 13.234.176.102
Connecting to github.com (github.com)|13.234.176.102|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://raw.githubusercontent.com/vignesh88/blog/master/kubernetes/etcd/etcd-v3.2.28-linux-amd64.tar.gz [following]
--2019-11-26 22:05:54-- https://raw.githubusercontent.com/vignesh88/blog/master/kubernetes/etcd/etcd-v3.2.28-linux-amd64.tar.gz
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 151.101.8.133
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|151.101.8.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10529149 (10M) [application/octet-stream]
Saving to: ‘etcd’

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;etcd 100%[=============================================================================&amp;gt;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 10.04M 4.47MB/s &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;2.2s    
&lt;span class=&quot;go&quot;&gt;
2019-11-26 22:05:57 (4.47 MB/s) - ‘etcd’ saved [10529149/10529149]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/backup$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;etcd pki&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Extract the etcd package&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/backup$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-xvf&lt;/span&gt; etcd
&lt;span class=&quot;go&quot;&gt;etcd-v3.2.28-linux-amd64/
etcd-v3.2.28-linux-amd64/etcdctl
etcd-v3.2.28-linux-amd64/etcd
etcd-v3.2.28-linux-amd64/README-etcdctl.md
etcd-v3.2.28-linux-amd64/README.md
etcd-v3.2.28-linux-amd64/Documentation/
etcd-v3.2.28-linux-amd64/Documentation/faq.md
etcd-v3.2.28-linux-amd64/Documentation/tuning.md
etcd-v3.2.28-linux-amd64/Documentation/dl_build.md
etcd-v3.2.28-linux-amd64/Documentation/benchmarks/
etcd-v3.2.28-linux-amd64/Documentation/benchmarks/etcd-2-2-0-rc-benchmarks.md
etcd-v3.2.28-linux-amd64/Documentation/benchmarks/etcd-3-demo-benchmarks.md
etcd-v3.2.28-linux-amd64/Documentation/benchmarks/etcd-storage-memory-benchmark.md
etcd-v3.2.28-linux-amd64/Documentation/benchmarks/_index.md
etcd-v3.2.28-linux-amd64/Documentation/benchmarks/README.md
etcd-v3.2.28-linux-amd64/Documentation/benchmarks/etcd-2-1-0-alpha-benchmarks.md
etcd-v3.2.28-linux-amd64/Documentation/benchmarks/etcd-2-2-0-rc-memory-benchmarks.md
etcd-v3.2.28-linux-amd64/Documentation/benchmarks/etcd-2-2-0-benchmarks.md
etcd-v3.2.28-linux-amd64/Documentation/benchmarks/etcd-3-watch-memory-benchmark.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/
etcd-v3.2.28-linux-amd64/Documentation/op-guide/security.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/authentication.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/recovery.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/container.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/supported-platform.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/monitoring.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/clustering.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/etcd3_alert.rules
etcd-v3.2.28-linux-amd64/Documentation/op-guide/grafana.json
etcd-v3.2.28-linux-amd64/Documentation/op-guide/_index.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/versioning.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/maintenance.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/gateway.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/runtime-configuration.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/performance.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/v2-migration.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/configuration.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/etcd-sample-grafana.png
etcd-v3.2.28-linux-amd64/Documentation/op-guide/hardware.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/grpc_proxy.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/runtime-reconf-design.md
etcd-v3.2.28-linux-amd64/Documentation/op-guide/failures.md
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/api_concurrency_reference_v3.md
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/experimental_apis.md
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/api_grpc_gateway.md
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/_index.md
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/interacting_v3.md
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/grpc_naming.md
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/local_cluster.md
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/api_reference_v3.md
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/limit.md
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/apispec/
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/apispec/swagger/
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/apispec/swagger/v3lock.swagger.json
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/apispec/swagger/rpc.swagger.json
etcd-v3.2.28-linux-amd64/Documentation/dev-guide/apispec/swagger/v3election.swagger.json
etcd-v3.2.28-linux-amd64/Documentation/_index.md
etcd-v3.2.28-linux-amd64/Documentation/README.md
etcd-v3.2.28-linux-amd64/Documentation/upgrades/
etcd-v3.2.28-linux-amd64/Documentation/upgrades/upgrade_3_2.md
etcd-v3.2.28-linux-amd64/Documentation/upgrades/upgrade_3_1.md
etcd-v3.2.28-linux-amd64/Documentation/upgrades/upgrading-etcd.md
etcd-v3.2.28-linux-amd64/Documentation/upgrades/_index.md
etcd-v3.2.28-linux-amd64/Documentation/upgrades/upgrade_3_4.md
etcd-v3.2.28-linux-amd64/Documentation/upgrades/upgrade_3_0.md
etcd-v3.2.28-linux-amd64/Documentation/upgrades/upgrade_3_3.md
etcd-v3.2.28-linux-amd64/Documentation/reporting_bugs.md
etcd-v3.2.28-linux-amd64/Documentation/production-users.md
etcd-v3.2.28-linux-amd64/Documentation/branch_management.md
etcd-v3.2.28-linux-amd64/Documentation/platforms/
etcd-v3.2.28-linux-amd64/Documentation/platforms/aws.md
etcd-v3.2.28-linux-amd64/Documentation/platforms/_index.md
etcd-v3.2.28-linux-amd64/Documentation/platforms/freebsd.md
etcd-v3.2.28-linux-amd64/Documentation/platforms/container-linux-systemd.md
etcd-v3.2.28-linux-amd64/Documentation/demo.md
etcd-v3.2.28-linux-amd64/Documentation/dev-internal/
etcd-v3.2.28-linux-amd64/Documentation/dev-internal/logging.md
etcd-v3.2.28-linux-amd64/Documentation/dev-internal/discovery_protocol.md
etcd-v3.2.28-linux-amd64/Documentation/dev-internal/_index.md
etcd-v3.2.28-linux-amd64/Documentation/dev-internal/release.md
etcd-v3.2.28-linux-amd64/Documentation/learning/
etcd-v3.2.28-linux-amd64/Documentation/learning/api_guarantees.md
etcd-v3.2.28-linux-amd64/Documentation/learning/glossary.md
etcd-v3.2.28-linux-amd64/Documentation/learning/why.md
etcd-v3.2.28-linux-amd64/Documentation/learning/auth_design.md
etcd-v3.2.28-linux-amd64/Documentation/learning/data_model.md
etcd-v3.2.28-linux-amd64/Documentation/learning/api.md
etcd-v3.2.28-linux-amd64/Documentation/docs.md
etcd-v3.2.28-linux-amd64/Documentation/integrations.md
etcd-v3.2.28-linux-amd64/Documentation/rfc/
etcd-v3.2.28-linux-amd64/Documentation/rfc/_index.md
etcd-v3.2.28-linux-amd64/Documentation/rfc/v3api.md
etcd-v3.2.28-linux-amd64/Documentation/metrics.md
etcd-v3.2.28-linux-amd64/READMEv2-etcdctl.md&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Navigate to the extraced directory&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/backup$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;etcd etcd-v3.2.28-linux-amd64 pki&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/backup$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;etcd-v3.2.28-linux-amd64/&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-3-backup-the-etcd-database&quot;&gt;Step 3: Backup the etcd database&lt;/h5&gt;

&lt;p&gt;Now you will see a etcdctl binary inside the directy.&lt;/p&gt;

&lt;p&gt;Use the key, certificate and CA certificate to take backup of the existing etcd database as shown below&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/backup/etcd-v3.2.28-linux-amd64$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ETCDCTL_API&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3 ./etcdctl &lt;span class=&quot;nt&quot;&gt;--endpoints&lt;/span&gt; https://127.0.0.1:2379 &lt;span class=&quot;nt&quot;&gt;--cert&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/etc/kubernetes/pki/etcd/server.crt &lt;span class=&quot;nt&quot;&gt;--key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/etc/kubernetes/pki/etcd/server.key &lt;span class=&quot;nt&quot;&gt;--cacert&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/etc/kubernetes/pki/etcd/ca.crt snapshot save ../etc_database_backup.db
&lt;span class=&quot;go&quot;&gt;Snapshot saved at ../etc_database_backup.db&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/backup/etcd-v3.2.28-linux-amd64$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ..
&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/backup$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;etcd etc_database_backup.db etcd-v3.2.28-linux-amd64 pki&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see the backup has been taken and saved as etc_database_backup.db&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name>Vignesh Ragupathy</name></author><category term="kubernetes" /><category term="linux" /><category term="opensource" /><summary type="html">Kubernetes cluster state is saved in etcd datastore. In the post we are going to see how to take a backup for etcd database in kubernetes cluster.</summary></entry><entry><title type="html">RBAC in kubernetes</title><link href="https://www.vikki.in/rbac-in-kubernetes/" rel="alternate" type="text/html" title="RBAC in kubernetes" /><published>2019-11-28T16:26:19+05:30</published><updated>2019-11-28T16:26:19+05:30</updated><id>https://www.vikki.in/rbac-in-kubernetes</id><content type="html" xml:base="https://www.vikki.in/rbac-in-kubernetes/">&lt;p&gt;There are 3 elements involved in RBAC. In this post we are going to see how to provide user level access to resources.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Subjects - Users or Process that wants access to Kubernetes API&lt;/li&gt;
  &lt;li&gt;Resources - Kubernetes API objects like pods, deployments etc&lt;/li&gt;
  &lt;li&gt;Verbs - Set of operations like get, watch create etc&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;setup&quot;&gt;&lt;strong&gt;Setup&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.&lt;/p&gt;

&lt;!--kg-card-begin: image--&gt;
&lt;figure class=&quot;kg-card kg-image-card&quot;&gt;&lt;img src=&quot;/content/images/2019/11/setup-6.jpg&quot; class=&quot;kg-image&quot; /&gt;&lt;/figure&gt;
&lt;!--kg-card-end: image--&gt;
&lt;h5 id=&quot;step-1-create-a-private-key&quot;&gt;Step 1: Create a private key&lt;/h5&gt;

&lt;p&gt;Create a new directly and navigate to the directory&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mkdir &lt;/span&gt;ssl
&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;ssl/&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Use openssl command a generate a private key &lt;em&gt;user1.key&lt;/em&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;openssl genrsa &lt;span class=&quot;nt&quot;&gt;-out&lt;/span&gt; user1.key 2048
&lt;span class=&quot;go&quot;&gt;Generating RSA private key, 2048 bit long modulus
.......................................................+++
.......................................................................................................................................+++
e is 65537 (0x10001)
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;user1.key&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-2-generate-a-csr&quot;&gt;Step 2: Generate a CSR&lt;/h5&gt;

&lt;p&gt;Use the private key generated in the privous step and generate the certificate signing request(csr)&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;openssl req &lt;span class=&quot;nt&quot;&gt;-new&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-key&lt;/span&gt; user1.key &lt;span class=&quot;nt&quot;&gt;-out&lt;/span&gt; user1.csr &lt;span class=&quot;nt&quot;&gt;-subj&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/CN=user1/O=vikki.in&quot;&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;user1.csr user1.key&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-3-sign-the-csr-and-generate-certificate&quot;&gt;Step 3: Sign the CSR and generate certificate&lt;/h5&gt;

&lt;p&gt;The kubernetes cluster have the CA(certificate authority) key and certificate available under /etc/kubernetes/pki location&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; /etc/kubernetes/pki/ca.
&lt;span class=&quot;go&quot;&gt;ca.crt ca.key  &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Use the CA certificate and key to sign the CSR&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;openssl x509 &lt;span class=&quot;nt&quot;&gt;-req&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-in&lt;/span&gt; user1.csr &lt;span class=&quot;nt&quot;&gt;-CA&lt;/span&gt; /etc/kubernetes/pki/ca.crt &lt;span class=&quot;nt&quot;&gt;-CAkey&lt;/span&gt; /etc/kubernetes/pki/ca.key &lt;span class=&quot;nt&quot;&gt;-CAcreateserial&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-out&lt;/span&gt; user1.crt &lt;span class=&quot;nt&quot;&gt;-days&lt;/span&gt; 365
&lt;span class=&quot;go&quot;&gt;[sudo] password for vikki: 
Signature ok
subject=/CN=user1/O=vikki.in
Getting CA Private Key

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;user1.crt user1.csr user1.key&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we have the private key &lt;em&gt;user1.key&lt;/em&gt; and signed certificate &lt;em&gt;user1.crt&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-4-set-credential-for-the-user&quot;&gt;Step 4: Set credential for the user&lt;/h5&gt;

&lt;p&gt;Now set credential for the user &lt;em&gt;user1&lt;/em&gt; with the private key and the signed certificate.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl config set-credentials user1 &lt;span class=&quot;nt&quot;&gt;--client-certificate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;user1.crt &lt;span class=&quot;nt&quot;&gt;--client-key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;user1.key 
&lt;span class=&quot;go&quot;&gt;User &quot;user1&quot; set.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-5-set-context-for-the-user&quot;&gt;Step 5: Set context for the user&lt;/h5&gt;

&lt;p&gt;Now set the new context with the username , cluster etc.&lt;/p&gt;

&lt;p&gt;We can also map the context to specific namespace using the –namespacec option. By default it will take the default namespace&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl config set-context user1-context &lt;span class=&quot;nt&quot;&gt;--cluster&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;kubernetes &lt;span class=&quot;nt&quot;&gt;--user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;user1
&lt;span class=&quot;go&quot;&gt;Context &quot;user1-context&quot; created.

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl config get-contexts 
&lt;span class=&quot;go&quot;&gt;CURRENT NAME CLUSTER AUTHINFO NAMESPACE
* kubernetes-admin@kubernetes kubernetes kubernetes-admin   
            user1-context kubernetes user1              &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see there are 2 context created.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-6-create-a-role&quot;&gt;Step 6: Create a role&lt;/h5&gt;

&lt;p&gt;Create a role and map the resources and verb required.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create role myrole &lt;span class=&quot;nt&quot;&gt;--verb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;get,create,list &lt;span class=&quot;nt&quot;&gt;--resource&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;pods
&lt;span class=&quot;go&quot;&gt;role.rbac.authorization.k8s.io/myrole created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-7-create-a-rolebinding&quot;&gt;Step 7: Create a rolebinding&lt;/h5&gt;

&lt;p&gt;Create a rolebinding and map the role and user.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create rolebinding myrolebinding &lt;span class=&quot;nt&quot;&gt;--role&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;myrole &lt;span class=&quot;nt&quot;&gt;--user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;user1 
&lt;span class=&quot;go&quot;&gt;rolebinding.rbac.authorization.k8s.io/myrolebinding created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-8-verify-role-and-rolebinding&quot;&gt;Step 8: Verify role and rolebinding&lt;/h5&gt;

&lt;p&gt;List the role and rolebinding and verify both are created.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get role
&lt;span class=&quot;go&quot;&gt;NAME AGE
myrole 58s
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get rolebindings.rbac.authorization.k8s.io 
&lt;span class=&quot;go&quot;&gt;NAME AGE
myrolebinding 8s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-9-change-the-context-and-verify-role-based-access&quot;&gt;Step 9: Change the context and verify role based access&lt;/h5&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl config get-contexts 
&lt;span class=&quot;go&quot;&gt;CURRENT NAME CLUSTER AUTHINFO NAMESPACE
* kubernetes-admin@kubernetes kubernetes kubernetes-admin   
            user1-context kubernetes user1     &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Switch to newly created contesxt &lt;em&gt;user1-context&lt;/em&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl config use-context user1-context 
&lt;span class=&quot;go&quot;&gt;Switched to context &quot;user1-context&quot;.

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl config get-contexts 
&lt;span class=&quot;go&quot;&gt;CURRENT NAME CLUSTER AUTHINFO NAMESPACE
            kubernetes-admin@kubernetes kubernetes kubernetes-admin   
* user1-context kubernetes user1           &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see the current context is switched to &lt;em&gt;user1-context.&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Try to create a deployement&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl run nginx-deployment &lt;span class=&quot;nt&quot;&gt;--image&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nginx
&lt;span class=&quot;go&quot;&gt;kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
Error from server (Forbidden): deployments.apps is forbidden: User &quot;user1&quot; cannot create resource &quot;deployments&quot; in API group &quot;apps&quot; in the namespace &quot;default&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;The deployment creation is failed because the new context has resource mapped only for pod.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Now lets create a pod and verify the status&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pod.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/aa1503f5161a453f120ab6b121f6325a.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pod.yaml 
&lt;span class=&quot;go&quot;&gt;pod/myapp-pod created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~/ssl$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pods
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE
httpd-7765f5994-vc2j5 1/1 Running 1 2d
myapp-pod 0/1 ContainerCreating 0 5s
nginx-7bffc778db-p4ff5 1/1 Running 1 2d&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see now the pod created successfully and running in the new context.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;We can also test the permission of user using the below command&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl auth can-i create deployments &lt;span class=&quot;nt&quot;&gt;--as&lt;/span&gt; user1
&lt;span class=&quot;go&quot;&gt;no

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl auth can-i create pods &lt;span class=&quot;nt&quot;&gt;--as&lt;/span&gt; user1
&lt;span class=&quot;go&quot;&gt;yes&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;</content><author><name>Vignesh Ragupathy</name></author><category term="kubernetes" /><category term="linux" /><category term="opensource" /><summary type="html">There are 3 elements involved in RBAC. In this post we are going to see how to provide user level access to resources.</summary></entry><entry><title type="html">Upgrading kubernetes cluster master and worker nodes</title><link href="https://www.vikki.in/upgrading-kubernetes-cluster-master-and-worker-nodes/" rel="alternate" type="text/html" title="Upgrading kubernetes cluster master and worker nodes" /><published>2019-11-26T15:07:58+05:30</published><updated>2019-11-26T15:07:58+05:30</updated><id>https://www.vikki.in/upgrading-kubernetes-cluster-master-and-worker-nodes</id><content type="html" xml:base="https://www.vikki.in/upgrading-kubernetes-cluster-master-and-worker-nodes/">&lt;p&gt;This post we are going to discuss how to upgrade the kubernetes cluster, both master and worker nodes. We are going to upgrade a older version v1.15 to v.1.16.&lt;/p&gt;

&lt;h3 id=&quot;setup&quot;&gt;&lt;strong&gt;Setup&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.&lt;/p&gt;

&lt;!--kg-card-begin: image--&gt;
&lt;figure class=&quot;kg-card kg-image-card&quot;&gt;&lt;img src=&quot;/content/images/2019/11/setup-5.jpg&quot; class=&quot;kg-image&quot; /&gt;&lt;/figure&gt;
&lt;!--kg-card-end: image--&gt;
&lt;h3 id=&quot;master-node&quot;&gt;Master node&lt;/h3&gt;

&lt;h5 id=&quot;step-1-verify-the-current-version-of-kubelet-and-kubeadm-running-in-all-nodes&quot;&gt;Step 1: Verify the current version of kubelet and kubeadm running in all nodes&lt;/h5&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get nodes
&lt;span class=&quot;go&quot;&gt;NAME STATUS ROLES AGE VERSION
kubernetes1 Ready master 41d v1.15.5
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;kubernetes2 Ready &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;41d v1.15.5&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubeadm version
&lt;span class=&quot;go&quot;&gt;kubeadm version: &amp;amp;version.Info{Major:&quot;1&quot;, Minor:&quot;15&quot;, GitVersion:&quot;v1.15.5&quot;, GitCommit:&quot;20c265fef0741dd71a66480e35bd69f18351daea&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2019-10-15T19:14:19Z&quot;, GoVersion:&quot;go1.12.10&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see kubelet and kubeadm is running in version v1.15.5&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-2-verify-the-lastest-stable-availble-version&quot;&gt;Step 2: Verify the lastest stable availble version&lt;/h5&gt;

&lt;p&gt;Run the update in kubernetes master node&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes1:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;apt update&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes1:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;apt-cache policy kubeadm
&lt;span class=&quot;go&quot;&gt;kubeadm:
    Installed: 1.15.5-00
    Candidate: 1.16.3-00
    Version table:
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;    .....&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see from this output that current version is 1.15.5 and the latest available is 1.16.3&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-3-upgrade-the-kubeadm-to-latest-version&quot;&gt;Step 3: Upgrade the kubeadm to latest version&lt;/h5&gt;

&lt;p&gt;Upgrade the kubeadm in master to the latest version 1.16.3&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes1:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;apt-mark unhold kubeadm &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; apt-get update &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;kubeadm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1.16.3-00 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; apt-mark hold kubeadm
&lt;span class=&quot;go&quot;&gt;kubeadm was already not hold.
Hit:1 http://us.archive.ubuntu.com/ubuntu xenial InRelease                  
Hit:2 http://security.ubuntu.com/ubuntu xenial-security InRelease
Hit:3 http://us.archive.ubuntu.com/ubuntu xenial-updates InRelease
Hit:4 http://us.archive.ubuntu.com/ubuntu xenial-backports InRelease
Hit:5 https://apt.kubernetes.io kubernetes-xenial InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following packages will be upgraded:
    kubeadm
1 upgraded, 0 newly installed, 0 to remove and 142 not upgraded.
Need to get 8,762 kB of archives.
After this operation, 4,062 kB of additional disk space will be used.
Get:1 https://apt.kubernetes.io kubernetes-xenial/main amd64 kubeadm amd64 1.16.3-00 [8,762 kB]
Fetched 8,762 kB in 7s (1,117 kB/s)                                                                                                                          
(Reading database ... 60808 files and directories currently installed.)
Preparing to unpack .../kubeadm_1.16.3-00_amd64.deb ...
Unpacking kubeadm (1.16.3-00) over (1.15.5-00) ...
Setting up kubeadm (1.16.3-00) ...
kubeadm set on hold.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-4-run-the-upgrade-plan&quot;&gt;Step 4: Run the upgrade plan&lt;/h5&gt;

&lt;p&gt;Now in the previous step we already updated the kubeadm to latest version. Now lets run the upgrade plan and see the available options.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes1:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;kubeadm upgrade plan
&lt;span class=&quot;go&quot;&gt;[upgrade/config] Making sure the configuration is correct:
[upgrade/config] Reading configuration from the cluster...
[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[preflight] Running pre-flight checks.
[upgrade] Making sure the cluster is healthy:
[upgrade] Fetching available versions to upgrade to
[upgrade/versions] Cluster version: v1.15.5
[upgrade/versions] kubeadm version: v1.16.3
[upgrade/versions] Latest stable version: v1.16.3
[upgrade/versions] Latest version in the v1.15 series: v1.15.6

Components that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply':
COMPONENT CURRENT AVAILABLE
Kubelet 2 x v1.15.5 v1.15.6

Upgrade to the latest version in the v1.15 series:

COMPONENT CURRENT AVAILABLE
API Server v1.15.5 v1.15.6
Controller Manager v1.15.5 v1.15.6
Scheduler v1.15.5 v1.15.6
Kube Proxy v1.15.5 v1.15.6
CoreDNS 1.3.1 1.6.2
Etcd 3.3.10 3.3.10

You can now apply the upgrade by executing the following command:

    kubeadm upgrade apply v1.15.6

_____________________________________________________________________

Components that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply':
COMPONENT CURRENT AVAILABLE
Kubelet 2 x v1.15.5 v1.16.3

Upgrade to the latest stable version:

COMPONENT CURRENT AVAILABLE
API Server v1.15.5 v1.16.3
Controller Manager v1.15.5 v1.16.3
Scheduler v1.15.5 v1.16.3
Kube Proxy v1.15.5 v1.16.3
CoreDNS 1.3.1 1.6.2
Etcd 3.3.10 3.3.15-0

You can now apply the upgrade by executing the following command:

    kubeadm upgrade apply v1.16.3

_____________________________________________________________________&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see that we can upgrade the cluster to v1.16.3 from the above output&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-5-drain-the-pods-in-master-node&quot;&gt;Step 5: Drain the pods in master node&lt;/h5&gt;

&lt;p&gt;Now drain all the pods execpt daemonsets in the master node&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl drain kubernetes1 &lt;span class=&quot;nt&quot;&gt;--ignore-daemonsets&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;node/kubernetes1 cordoned
WARNING: ignoring DaemonSet-managed Pods: kube-system/kube-flannel-ds-amd64-bfr9j, kube-system/kube-proxy-8267n
evicting pod &quot;coredns-5c98db65d4-v4cms&quot;
evicting pod &quot;coredns-5c98db65d4-g4gv4&quot;
pod/coredns-5c98db65d4-v4cms evicted
pod/coredns-5c98db65d4-g4gv4 evicted
node/kubernetes1 evicted&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-6-run-the-upgrade&quot;&gt;Step 6: Run the upgrade&lt;/h5&gt;

&lt;p&gt;Now run the upgrade to the lastest version 1.16.3&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;kubeadm upgrade apply v1.16.3
&lt;span class=&quot;go&quot;&gt;[upgrade/config] Making sure the configuration is correct:
[upgrade/config] Reading configuration from the cluster...
[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[preflight] Running pre-flight checks.
[upgrade] Making sure the cluster is healthy:
[upgrade/version] You have chosen to change the cluster version to &quot;v1.16.3&quot;
[upgrade/versions] Cluster version: v1.15.5
[upgrade/versions] kubeadm version: v1.16.3
[upgrade/confirm] Are you sure you want to proceed with the upgrade? [y/N]: y
[upgrade/prepull] Will prepull images for components [kube-apiserver kube-controller-manager kube-scheduler etcd]
[upgrade/prepull] Prepulling image for component etcd.
[upgrade/prepull] Prepulling image for component kube-apiserver.
[upgrade/prepull] Prepulling image for component kube-controller-manager.
[upgrade/prepull] Prepulling image for component kube-scheduler.
[apiclient] Found 0 Pods for label selector k8s-app=upgrade-prepull-etcd
[apiclient] Found 0 Pods for label selector k8s-app=upgrade-prepull-kube-scheduler
[apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-kube-controller-manager
[apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-kube-apiserver
[apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-etcd
[apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-kube-scheduler
[upgrade/prepull] Prepulled image for component etcd.
[upgrade/prepull] Prepulled image for component kube-apiserver.
[upgrade/prepull] Prepulled image for component kube-controller-manager.
[upgrade/prepull] Prepulled image for component kube-scheduler.
[upgrade/prepull] Successfully prepulled the images for all the control plane components
[upgrade/apply] Upgrading your Static Pod-hosted control plane to version &quot;v1.16.3&quot;...
Static pod: kube-apiserver-kubernetes1 hash: b9d225e73ea8b0b21921bdd78ea5415e
Static pod: kube-controller-manager-kubernetes1 hash: f106f0d94b93b77e4db974b1c477d277
Static pod: kube-scheduler-kubernetes1 hash: 131c3f63daec7c0750818f64a2f75d20
[upgrade/etcd] Upgrading to TLS for etcd
Static pod: etcd-kubernetes1 hash: 352a2620657e49493504dc8f27c83195
[upgrade/staticpods] Preparing for &quot;etcd&quot; upgrade
[upgrade/staticpods] Renewing etcd-server certificate
[upgrade/staticpods] Renewing etcd-peer certificate
[upgrade/staticpods] Renewing etcd-healthcheck-client certificate
[upgrade/staticpods] Moved new manifest to &quot;/etc/kubernetes/manifests/etcd.yaml&quot; and backed up old manifest to &quot;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-26-18-04-49/etcd.yaml&quot;
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
Static pod: etcd-kubernetes1 hash: 352a2620657e49493504dc8f27c83195
Static pod: etcd-kubernetes1 hash: 3ce412f7cfe0c06939809c93f738e798
[apiclient] Found 1 Pods for label selector component=etcd
[upgrade/staticpods] Component &quot;etcd&quot; upgraded successfully!
[upgrade/etcd] Waiting for etcd to become available
[upgrade/staticpods] Writing new Static Pod manifests to &quot;/etc/kubernetes/tmp/kubeadm-upgraded-manifests001214141&quot;
[upgrade/staticpods] Preparing for &quot;kube-apiserver&quot; upgrade
[upgrade/staticpods] Renewing apiserver certificate
[upgrade/staticpods] Renewing apiserver-kubelet-client certificate
[upgrade/staticpods] Renewing front-proxy-client certificate
[upgrade/staticpods] Renewing apiserver-etcd-client certificate
[upgrade/staticpods] Moved new manifest to &quot;/etc/kubernetes/manifests/kube-apiserver.yaml&quot; and backed up old manifest to &quot;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-26-18-04-49/kube-apiserver.yaml&quot;
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
Static pod: kube-apiserver-kubernetes1 hash: b9d225e73ea8b0b21921bdd78ea5415e
Static pod: kube-apiserver-kubernetes1 hash: b9d225e73ea8b0b21921bdd78ea5415e
Static pod: kube-apiserver-kubernetes1 hash: b9d225e73ea8b0b21921bdd78ea5415e
Static pod: kube-apiserver-kubernetes1 hash: d8708cb2f25dd11bbb41dd9729149325
[apiclient] Found 1 Pods for label selector component=kube-apiserver
[upgrade/staticpods] Component &quot;kube-apiserver&quot; upgraded successfully!
[upgrade/staticpods] Preparing for &quot;kube-controller-manager&quot; upgrade
[upgrade/staticpods] Renewing controller-manager.conf certificate
[upgrade/staticpods] Moved new manifest to &quot;/etc/kubernetes/manifests/kube-controller-manager.yaml&quot; and backed up old manifest to &quot;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-26-18-04-49/kube-controller-manager.yaml&quot;
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
Static pod: kube-controller-manager-kubernetes1 hash: f106f0d94b93b77e4db974b1c477d277
Static pod: kube-controller-manager-kubernetes1 hash: e6e76bb8264f2e84070efada35e93e71
[apiclient] Found 1 Pods for label selector component=kube-controller-manager
[upgrade/staticpods] Component &quot;kube-controller-manager&quot; upgraded successfully!
[upgrade/staticpods] Preparing for &quot;kube-scheduler&quot; upgrade
[upgrade/staticpods] Renewing scheduler.conf certificate
[upgrade/staticpods] Moved new manifest to &quot;/etc/kubernetes/manifests/kube-scheduler.yaml&quot; and backed up old manifest to &quot;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-26-18-04-49/kube-scheduler.yaml&quot;
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
Static pod: kube-scheduler-kubernetes1 hash: 131c3f63daec7c0750818f64a2f75d20
Static pod: kube-scheduler-kubernetes1 hash: 8c5e33e50bb56e8adacd1cc99c56b2cb
[apiclient] Found 1 Pods for label selector component=kube-scheduler
[upgrade/staticpods] Component &quot;kube-scheduler&quot; upgraded successfully!
[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace
[kubelet] Creating a ConfigMap &quot;kubelet-config-1.16&quot; in namespace kube-system with the configuration for the kubelets in the cluster
[kubelet-start] Downloading configuration for the kubelet from the &quot;kubelet-config-1.16&quot; ConfigMap in the kube-system namespace
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

[upgrade/successful] SUCCESS! Your cluster was upgraded to &quot;v1.16.3&quot;. Enjoy!

[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see the cluster is upgraded to lastest version v1.16.3&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-7-uncordon-the-master-node&quot;&gt;Step 7: Uncordon the master node&lt;/h5&gt;

&lt;p&gt;Now ucordon the master node&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl uncordon kubernetes1 
&lt;span class=&quot;go&quot;&gt;node/kubernetes1 uncordoned&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-8-upgrade-the-kubelet&quot;&gt;Step 8: Upgrade the kubelet&lt;/h5&gt;

&lt;p&gt;Now in the previous steps we have upgraded the kubeadm and cluster , next we need to upgrade the kubelet and kubectl&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes1:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;apt-mark unhold kubelet kubectl &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; apt-get update &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;kubelet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1.16.3-00 &lt;span class=&quot;nv&quot;&gt;kubectl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1.16.3-00 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; apt-mark hold kubelet kubectl
&lt;span class=&quot;go&quot;&gt;kubelet was already not hold.
kubectl was already not hold.
Hit:1 http://security.ubuntu.com/ubuntu xenial-security InRelease           
Hit:2 http://us.archive.ubuntu.com/ubuntu xenial InRelease
Hit:3 http://us.archive.ubuntu.com/ubuntu xenial-updates InRelease
Hit:4 http://us.archive.ubuntu.com/ubuntu xenial-backports InRelease
Hit:5 https://apt.kubernetes.io kubernetes-xenial InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following packages will be upgraded:
    kubectl kubelet
2 upgraded, 0 newly installed, 0 to remove and 140 not upgraded.
Need to get 29.9 MB of archives.
After this operation, 7,134 kB of additional disk space will be used.
Get:1 https://apt.kubernetes.io kubernetes-xenial/main amd64 kubectl amd64 1.16.3-00 [9,233 kB]
Get:2 https://apt.kubernetes.io kubernetes-xenial/main amd64 kubelet amd64 1.16.3-00 [20.7 MB]                                                               
Fetched 29.9 MB in 8s (3,436 kB/s)                                                                                                                           
(Reading database ... 60808 files and directories currently installed.)
Preparing to unpack .../kubectl_1.16.3-00_amd64.deb ...
Unpacking kubectl (1.16.3-00) over (1.15.5-00) ...
Preparing to unpack .../kubelet_1.16.3-00_amd64.deb ...
Unpacking kubelet (1.16.3-00) over (1.15.5-00) ...
Setting up kubectl (1.16.3-00) ...
Setting up kubelet (1.16.3-00) ...
kubelet set on hold.
kubectl set on hold.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Restart the kubelet service&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes1:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl restart kubelet&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get nodes
&lt;span class=&quot;go&quot;&gt;NAME STATUS ROLES AGE VERSION
kubernetes1 Ready master 41d v1.16.3
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;kubernetes2 Ready &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;41d v1.15.5&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see the master node kubernetes1 is upgraded to v1.16.3&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;worker-node&quot;&gt;Worker node&lt;/h3&gt;

&lt;h5 id=&quot;step-1-upgrade-the-kubeadm-to-version-1163&quot;&gt;Step 1: Upgrade the kubeadm to version 1.16.3&lt;/h5&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes2:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;apt-mark unhold kubeadm &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; apt-get update &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;kubeadm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1.16.3-00 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; apt-mark hold kubeadm
&lt;span class=&quot;go&quot;&gt;kubeadm was already not hold.
Get:1 http://security.ubuntu.com/ubuntu xenial-security InRelease [109 kB]                 
Get:2 http://security.ubuntu.com/ubuntu xenial-security/main amd64 Packages [785 kB]       
Hit:3 http://us.archive.ubuntu.com/ubuntu xenial InRelease
Get:4 http://us.archive.ubuntu.com/ubuntu xenial-updates InRelease [109 kB]      
Get:5 https://apt.kubernetes.io kubernetes-xenial InRelease [161 B]
Get:6 https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages [31.3 kB]                      
Get:7 http://us.archive.ubuntu.com/ubuntu xenial-backports InRelease [107 kB]        
Get:8 http://us.archive.ubuntu.com/ubuntu xenial-updates/main amd64 Packages [1,071 kB]             
Get:9 http://security.ubuntu.com/ubuntu xenial-security/main i386 Packages [617 kB]     
Get:10 http://security.ubuntu.com/ubuntu xenial-security/main Translation-en [302 kB]                                                                        
Get:11 http://security.ubuntu.com/ubuntu xenial-security/universe amd64 Packages [466 kB]                                                                    
Get:12 http://us.archive.ubuntu.com/ubuntu xenial-updates/main i386 Packages [882 kB]                                                                        
Get:13 http://security.ubuntu.com/ubuntu xenial-security/universe i386 Packages [401 kB]                                                                     
Get:14 http://security.ubuntu.com/ubuntu xenial-security/universe Translation-en [191 kB]                                                                    
Get:15 http://security.ubuntu.com/ubuntu xenial-security/multiverse amd64 Packages [5,724 B]                                                                 
Get:16 http://security.ubuntu.com/ubuntu xenial-security/multiverse i386 Packages [5,888 B]                                                                  
Get:17 http://us.archive.ubuntu.com/ubuntu xenial-updates/main Translation-en [413 kB]                                                                       
Get:18 http://us.archive.ubuntu.com/ubuntu xenial-updates/universe amd64 Packages [771 kB]                                                                   
Get:19 http://us.archive.ubuntu.com/ubuntu xenial-updates/universe i386 Packages [700 kB]                                                                    
Get:20 http://us.archive.ubuntu.com/ubuntu xenial-updates/universe Translation-en [324 kB]                                                                   
Get:21 http://us.archive.ubuntu.com/ubuntu xenial-updates/multiverse amd64 Packages [16.8 kB]                                                                
Get:22 http://us.archive.ubuntu.com/ubuntu xenial-updates/multiverse i386 Packages [15.9 kB]                                                                 
Fetched 7,333 kB in 23s (315 kB/s)                                                                                                                           
Reading package lists... Done
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following packages will be upgraded:
    kubeadm
1 upgraded, 0 newly installed, 0 to remove and 139 not upgraded.
Need to get 8,762 kB of archives.
After this operation, 4,062 kB of additional disk space will be used.
Get:1 https://apt.kubernetes.io kubernetes-xenial/main amd64 kubeadm amd64 1.16.3-00 [8,762 kB]
Fetched 8,762 kB in 7s (1,122 kB/s)                                                                                                                          
(Reading database ... 60808 files and directories currently installed.)
Preparing to unpack .../kubeadm_1.16.3-00_amd64.deb ...
Unpacking kubeadm (1.16.3-00) over (1.15.5-00) ...
Setting up kubeadm (1.16.3-00) ...
kubeadm set on hold.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-2-drain-the-pods-in-worker-node&quot;&gt;Step 2: Drain the pods in worker node&lt;/h5&gt;

&lt;p&gt;Now drain all the pods , except daemonsets from the worker node kubernetes2. &lt;em&gt;This command should be run in master node in case the kubenetes config is not mapped in worker&lt;/em&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl drain kubernetes2 &lt;span class=&quot;nt&quot;&gt;--ignore-daemonsets&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;node/kubernetes2 cordoned
WARNING: ignoring DaemonSet-managed Pods: kube-system/kube-flannel-ds-amd64-8v6lb, kube-system/kube-proxy-877b2
evicting pod &quot;coredns-5644d7b6d9-t8qw5&quot;
evicting pod &quot;httpd-7765f5994-gvlj6&quot;
evicting pod &quot;nginx-7bffc778db-phdb5&quot;
evicting pod &quot;coredns-5644d7b6d9-frz4v&quot;
pod/coredns-5644d7b6d9-frz4v evicted
pod/coredns-5644d7b6d9-t8qw5 evicted
pod/httpd-7765f5994-gvlj6 evicted
pod/nginx-7bffc778db-phdb5 evicted
node/kubernetes2 evicted&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-3-upgrade-the-worker-node&quot;&gt;Step 3: Upgrade the worker node&lt;/h5&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes2:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;kubeadm upgrade node
&lt;span class=&quot;go&quot;&gt;[upgrade] Reading configuration from the cluster...
[upgrade] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[upgrade] Skipping phase. Not a control plane node[kubelet-start] Downloading configuration for the kubelet from the &quot;kubelet-config-1.16&quot; ConfigMap in the kube-system namespace
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[upgrade] The configuration for this node was successfully updated!
[upgrade] Now you should go ahead and upgrade the kubelet package using your package manager.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-4-upgrade-the-kubelet-and-kubectl&quot;&gt;Step 4: Upgrade the kubelet and kubectl&lt;/h5&gt;

&lt;p&gt;In previous steps we upgraded the kubeadm and cluster. Now we need to upgrade the kubelet and kubectl.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes2:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;apt-mark unhold kubelet kubectl &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; apt-get update &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;kubelet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1.16.3-00 &lt;span class=&quot;nv&quot;&gt;kubectl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1.16.3-00 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; apt-mark hold kubelet kubectl
&lt;span class=&quot;go&quot;&gt;kubelet was already not hold.
kubectl was already not hold.
Hit:1 http://security.ubuntu.com/ubuntu xenial-security InRelease
Hit:2 http://us.archive.ubuntu.com/ubuntu xenial InRelease                       
Hit:3 http://us.archive.ubuntu.com/ubuntu xenial-updates InRelease
Hit:4 http://us.archive.ubuntu.com/ubuntu xenial-backports InRelease
Hit:5 https://apt.kubernetes.io kubernetes-xenial InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following packages will be upgraded:
    kubectl kubelet
2 upgraded, 0 newly installed, 0 to remove and 137 not upgraded.
Need to get 29.9 MB of archives.
After this operation, 3,447 kB of additional disk space will be used.
Get:1 https://apt.kubernetes.io kubernetes-xenial/main amd64 kubectl amd64 1.16.3-00 [9,233 kB]
Get:2 https://apt.kubernetes.io kubernetes-xenial/main amd64 kubelet amd64 1.16.3-00 [20.7 MB]                                                               
Fetched 29.9 MB in 32s (934 kB/s)                                                                                                                            
(Reading database ... 60808 files and directories currently installed.)
Preparing to unpack .../kubectl_1.16.3-00_amd64.deb ...
Unpacking kubectl (1.16.3-00) over (1.16.2-00) ...
Preparing to unpack .../kubelet_1.16.3-00_amd64.deb ...
Unpacking kubelet (1.16.3-00) over (1.15.5-00) ...
Setting up kubectl (1.16.3-00) ...
Setting up kubelet (1.16.3-00) ...
kubelet set on hold.
kubectl set on hold.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Restart the kubelet service in worker node&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes2:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl restart kubelet&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-5-uncordon-the-worker-node&quot;&gt;Step 5: Uncordon the worker node&lt;/h5&gt;

&lt;p&gt;Now uncordon all the pods in kubernetes2 worker onde&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl uncordon kubernetes2
&lt;span class=&quot;go&quot;&gt;node/kubernetes2 uncordoned&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get nodes
&lt;span class=&quot;go&quot;&gt;NAME STATUS ROLES AGE VERSION
kubernetes1 Ready master 41d v1.16.3
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;kubernetes2 Ready &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;41d v1.16.3&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see now both the master and worker nodes are upgraded from v1.15.5 to v1.16.3&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name>Vignesh Ragupathy</name></author><category term="kubernetes" /><category term="linux" /><category term="opensource" /><summary type="html">This post we are going to discuss how to upgrade the kubernetes cluster, both master and worker nodes. We are going to upgrade a older version v1.15 to v.1.16.</summary></entry><entry><title type="html">Running kubernetes custom scheduler</title><link href="https://www.vikki.in/running-kubernetes-custom-scheduler/" rel="alternate" type="text/html" title="Running kubernetes custom scheduler" /><published>2019-11-25T17:28:55+05:30</published><updated>2019-11-25T17:28:55+05:30</updated><id>https://www.vikki.in/running-kubernetes-custom-scheduler</id><content type="html" xml:base="https://www.vikki.in/running-kubernetes-custom-scheduler/">&lt;p&gt;Kubernetes cluster have a default scheduler kube-scheduler. If the default scheduler does not suits our requirement we can also create our own scheduler. In the post we will discus how to create multiple scheduler and schedule pods based on different scheduler.&lt;/p&gt;

&lt;h3 id=&quot;setup&quot;&gt;&lt;strong&gt;Setup&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.&lt;/p&gt;

&lt;!--kg-card-begin: image--&gt;
&lt;figure class=&quot;kg-card kg-image-card&quot;&gt;&lt;img src=&quot;/content/images/2019/11/setup-4.jpg&quot; class=&quot;kg-image&quot; /&gt;&lt;/figure&gt;
&lt;!--kg-card-end: image--&gt;
&lt;h5 id=&quot;step-1-copy-the-default-scheduler-yaml-and-modify&quot;&gt;Step 1: Copy the default scheduler yaml and modify&lt;/h5&gt;

&lt;p&gt;Copy the default scheduler yaml from master node and modify the name.&lt;/p&gt;

&lt;p&gt;In this below example i am naming the custom schedule are &lt;em&gt;my-scheduler.&lt;/em&gt; Add a ServiceAccount and ClusterRoleBinding to the yaml file as given below.&lt;/p&gt;

&lt;p&gt;The key changes made are&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;line 27: name: my-scheduler&lt;/li&gt;
  &lt;li&gt;line 30: serviceAccountName: my-scheduler&lt;/li&gt;
  &lt;li&gt;line 38: - –leader-elect=false&lt;/li&gt;
  &lt;li&gt;line 39: - –scheduler-name=my-scheduler&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo cp&lt;/span&gt; /etc/kubernetes/manifests/kube-scheduler.yaml custom-scheduler.yaml
&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo chmod &lt;/span&gt;777 custom-scheduler.yaml 
&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim custom-scheduler.yaml &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/2a8e765cb702a7f8edf4e8760599da10.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;h5 id=&quot;step-2-create-the-custom-scheduler&quot;&gt;Step 2: Create the custom scheduler&lt;/h5&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; custom-scheduler.yaml 
&lt;span class=&quot;go&quot;&gt;serviceaccount/my-scheduler created
clusterrolebinding.rbac.authorization.k8s.io/my-scheduler-as-kube-scheduler created
pod/my-scheduler created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pods &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;kube-system 
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE
calico-kube-controllers-55754f75c-fgs8g 1/1 Running 7 22d
calico-node-4h72l 1/1 Running 7 22d
calico-node-ld84s 1/1 Running 7 22d
calico-node-lrfz9 1/1 Running 2 31h
calico-node-ws576 1/1 Running 1 27h
coredns-5644d7b6d9-2g6rs 1/1 Running 7 22d
coredns-5644d7b6d9-ccxsg 1/1 Running 7 22d
etcd-kubernetes1 1/1 Running 8 22d
kube-apiserver-kubernetes1 1/1 Running 8 22d
kube-controller-manager-kubernetes1 1/1 Running 8 22d
kube-proxy-6xd8l 1/1 Running 2 31h
kube-proxy-96q5x 1/1 Running 7 22d
kube-proxy-njl6r 1/1 Running 7 22d
kube-proxy-whlhw 1/1 Running 1 27h
kube-scheduler-kubernetes1 1/1 Running 8 22d
my-scheduler 1/1 Running 0 6s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see a new custom scheduler &lt;em&gt;my-scheduler&lt;/em&gt; is running along with defautl scheduler &lt;em&gt;kube-scheduler-kubernetes1&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-3-edit-the-custerrole-for-kube-scheduler&quot;&gt;Step 3: Edit the custerrole for kube-scheduler&lt;/h5&gt;

&lt;p&gt;If RBAC is enabled on your cluster, you must update the system:kube-scheduler cluster role. Edit the clusterrole for kube-scheduler and modify.&lt;/p&gt;

&lt;p&gt;Below are the key changes made in orignal file&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;line 33: - my-scheduler&lt;/li&gt;
  &lt;li&gt;line 131: - storageclasses&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl edit clusterrole system:kube-scheduler&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/801aa697779378ff30e46e5247de8980.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;h5 id=&quot;step-4-create-pods-with-different-types-of-scheduler&quot;&gt;Step 4: Create pods with different types of scheduler&lt;/h5&gt;

&lt;p&gt;Create a pod without explicitly mentioning any scheuler name. This pod should be scheduled by default scheduler &lt;em&gt;kube-scheduler&lt;/em&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pod_default_scheduler.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/cfe05dda5b00a4f170b9cdd08f6aa0dd.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;

&lt;p&gt;Create a pod by explicitly mentioning custom scheuler name &lt;em&gt;my-scheduler&lt;/em&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pod_custom_scheduler.yaml &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/04cc5ac3e1933b4c1979a631de424116.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pod_default_scheduler.yaml 
&lt;span class=&quot;go&quot;&gt;pod/nginx-pod-default-scheduler created
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pod_custom_scheduler.yaml 
&lt;span class=&quot;go&quot;&gt;pod/nginx-pod-custom-scheduler created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pods nginx-pod-custom-scheduler nginx-pod-default-scheduler
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE
nginx-pod-custom-scheduler 1/1 Running 0 9m9s
nginx-pod-default-scheduler 1/1 Running 0 9m13s
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see both the pods are created and running&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get events &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; wide |grep nginx-pod-custom-scheduler |head &lt;span class=&quot;nt&quot;&gt;-1&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;&amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;Normal Scheduled pod/nginx-pod-custom-scheduler my-scheduler Successfully assigned default/nginx-pod-custom-scheduler to kubernetes3 &amp;lt;unknown&amp;gt; 0 nginx-pod-custom-scheduler.15da76383c2c2859
&lt;span class=&quot;go&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get events &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; wide |grep nginx-pod-default-scheduler |head &lt;span class=&quot;nt&quot;&gt;-1&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;&amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;Normal Scheduled pod/nginx-pod-default-scheduler default-scheduler Successfully assigned default/nginx-pod-default-scheduler to kubernetes3 &amp;lt;unknown&amp;gt; 0 nginx-pod-default-scheduler.15da76372f4444f7&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;From the events, we can see pod nginx-pod-custom-scheduler is scheduled by &lt;em&gt;my-scheduler&lt;/em&gt; and nginx-pod-default-scheduler by  &lt;em&gt;default-scheduler.&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name>Vignesh Ragupathy</name></author><category term="kubernetes" /><category term="linux" /><category term="opensource" /><summary type="html">Kubernetes cluster have a default scheduler kube-scheduler. If the default scheduler does not suits our requirement we can also create our own scheduler. In the post we will discus how to create multiple scheduler and schedule pods based on different scheduler.</summary></entry><entry><title type="html">Creating static pod in kubernetes</title><link href="https://www.vikki.in/creating-static-pod-in-kubernetes/" rel="alternate" type="text/html" title="Creating static pod in kubernetes" /><published>2019-11-24T15:55:52+05:30</published><updated>2019-11-24T15:55:52+05:30</updated><id>https://www.vikki.in/creating-static-pod-in-kubernetes</id><content type="html" xml:base="https://www.vikki.in/creating-static-pod-in-kubernetes/">&lt;p&gt;Static Pods are managed directly by the kubelet daemon on a specific node, without the API server observing them.&lt;br /&gt;
Static pods automatically restarts if it crashes. Static Pods are always bound to one Kubelet on a specific node. In the post we will try creating a static pod and watch the behaviour on delete.&lt;/p&gt;

&lt;h3 id=&quot;setup&quot;&gt;&lt;strong&gt;Setup&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.&lt;/p&gt;

&lt;!--kg-card-begin: image--&gt;
&lt;figure class=&quot;kg-card kg-image-card&quot;&gt;&lt;img src=&quot;/content/images/2019/11/setup-3.jpg&quot; class=&quot;kg-image&quot; /&gt;&lt;/figure&gt;
&lt;!--kg-card-end: image--&gt;
&lt;h5 id=&quot;step-1-find-the-static-pod-manifest-location&quot;&gt;Step 1: Find the static pod manifest location&lt;/h5&gt;

&lt;p&gt;Go to any node where you want to run the static pod. I want to run in kubernetes3 node. Look for the kubelet process and config.yaml file associated with it&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes3:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;ps &lt;span class=&quot;nt&quot;&gt;-aux&lt;/span&gt; |grep kubelet
&lt;span class=&quot;go&quot;&gt;root 905 3.6 9.4 544516 95676 ? Ssl 16:49 9:13 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --cgroup-driver=cgroupfs --network-plugin=cni --pod-infra-container-image=k8s.gcr.io/pause:3.1
root 29041 0.0 0.0 14224 940 pts/0 S+ 21:03 0:00 grep --color=auto kubelet&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Now grep for the staticPodPath in config file&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes3:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /var/lib/kubelet/config.yaml |grep static
&lt;span class=&quot;go&quot;&gt;staticPodPath: /etc/kubernetes/manifests&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-2-go-to-the-directory-and-add-a-yaml-for-pod&quot;&gt;Step 2: Go to the directory and add a yaml for pod&lt;/h5&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes3:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc/kubernetes/manifests/
&lt;span class=&quot;gp&quot;&gt;root@kubernetes3:/etc/kubernetes/manifests#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim static-pod.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/bbd1584780b98d771c479a4413c97b6e.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;

&lt;p&gt;Now try to grep for the pod name in the docker container list&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes3:/etc/kubernetes/manifests#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;docker ps &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; |grep static-web
&lt;span class=&quot;go&quot;&gt;e5bf8054343a nginx &quot;nginx -g 'daemon of…&quot; 17 seconds ago Up 16 seconds k8s_web_static-web-kubernetes3_default_b42924f0dce4ce471e92742ee9bf65d7_0
138ea3819894 k8s.gcr.io/pause:3.1 &quot;/pause&quot; 23 seconds ago Up 22 seconds k8s_POD_static-web-kubernetes3_default_b42924f0dce4ce471e92742ee9bf65d7_0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see a new static pod is created automatically&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-3-delete-the-container-and-watch-the-behaviour&quot;&gt;Step 3: Delete the container and watch the behaviour&lt;/h5&gt;

&lt;p&gt;Now lets try to delete the static pod  &lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes3:/etc/kubernetes/manifests#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;docker stop k8s_web_static-web-kubernetes3_default_b42924f0dce4ce471e92742ee9bf65d7_0
&lt;span class=&quot;go&quot;&gt;k8s_web_static-web-kubernetes3_default_b42924f0dce4ce471e92742ee9bf65d7_0
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes3:/etc/kubernetes/manifests#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;docker &lt;span class=&quot;nb&quot;&gt;rm &lt;/span&gt;k8s_web_static-web-kubernetes3_default_b42924f0dce4ce471e92742ee9bf65d7_0
&lt;span class=&quot;go&quot;&gt;k8s_web_static-web-kubernetes3_default_b42924f0dce4ce471e92742ee9bf65d7_0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes3:/etc/kubernetes/manifests#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;docker ps &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; |grep static-web
&lt;span class=&quot;go&quot;&gt;d3d9713b937e nginx &quot;nginx -g 'daemon of…&quot; 1 second ago Up Less than a second k8s_web_static-web-kubernetes3_default_b42924f0dce4ce471e92742ee9bf65d7_1
138ea3819894 k8s.gcr.io/pause:3.1 &quot;/pause&quot; About a minute ago Up About a minute k8s_POD_static-web-kubernetes3_default_b42924f0dce4ce471e92742ee9bf65d7_0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see the new static pod is automatically creating&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name>Vignesh Ragupathy</name></author><category term="kubernetes" /><category term="linux" /><category term="opensource" /><summary type="html">Static Pods are managed directly by the kubelet daemon on a specific node, without the API server observing them. Static pods automatically restarts if it crashes. Static Pods are always bound to one Kubelet on a specific node. In the post we will try creating a static pod and watch the behaviour on delete.</summary></entry><entry><title type="html">Pod scheduling in kubernetes - detailed step by step</title><link href="https://www.vikki.in/pod-scheduling-in-kubernetes-detailed-step-by-step/" rel="alternate" type="text/html" title="Pod scheduling in kubernetes - detailed step by step" /><published>2019-11-24T14:42:51+05:30</published><updated>2019-11-24T14:42:51+05:30</updated><id>https://www.vikki.in/pod-scheduling-in-kubernetes-detailed-step-by-step</id><content type="html" xml:base="https://www.vikki.in/pod-scheduling-in-kubernetes-detailed-step-by-step/">&lt;p&gt;We can assign the pod to node based on various methods. Lets discuss all the below methods in the post&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Using nodeName&lt;/li&gt;
  &lt;li&gt;Using labels in nodeSelector&lt;/li&gt;
  &lt;li&gt;Node Affinity/Anti Affinity&lt;/li&gt;
  &lt;li&gt;Pod Affinity/Anti Affinity&lt;/li&gt;
  &lt;li&gt;Taints and tolerations&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;setup&quot;&gt;&lt;strong&gt;Setup&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.&lt;/p&gt;

&lt;!--kg-card-begin: image--&gt;
&lt;figure class=&quot;kg-card kg-image-card&quot;&gt;&lt;img src=&quot;/content/images/2019/11/setup-2.jpg&quot; class=&quot;kg-image&quot; /&gt;&lt;/figure&gt;
&lt;!--kg-card-end: image--&gt;
&lt;h3 id=&quot;using-nodename&quot;&gt;Using nodeName&lt;/h3&gt;

&lt;h5 id=&quot;step-1-create-a-pod-and-assign-using-nodename&quot;&gt;Step 1: Create a pod and assign using nodeName&lt;/h5&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pod_node_name.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/5f329160b5846ba72beba94bd46f8860.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl apply &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pod_node_name.yaml 
&lt;span class=&quot;go&quot;&gt;pod/nginx-pod-nodename created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pods &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; wide
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;busybox 1/1 Running 4 5h47m 192.168.249.141 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;nginx-pod-nodename 1/1 Running 0 8s 192.168.80.199 kubernetes3 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;web-0 1/1 Running 2 5h21m 192.168.249.139 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;web-1 1/1 Running 2 5h21m 192.168.249.140 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;web-2 1/1 Running 2 5h22m 192.168.249.138 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see the pod is created in the node “kubernetes3” conifgued in nodeName option&lt;/p&gt;
&lt;/blockquote&gt;

&lt;!--kg-card-begin: hr--&gt;
&lt;hr /&gt;
&lt;!--kg-card-end: hr--&gt;
&lt;h3 id=&quot;using-labels-in-nodeselector&quot;&gt;Using labels in nodeSelector&lt;/h3&gt;

&lt;h5 id=&quot;step-1-add-a-new-label-to-the-node&quot;&gt;Step 1: Add a new label to the node&lt;/h5&gt;

&lt;p&gt;Check the current lables using the below command&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get nodes &lt;span class=&quot;nt&quot;&gt;--show-labels&lt;/span&gt; 
&lt;span class=&quot;go&quot;&gt;NAME STATUS ROLES AGE VERSION LABELS
kubernetes1 Ready master 20d v1.16.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=kubernetes1,kubernetes.io/os=linux,node-role.kubernetes.io/master=
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;kubernetes2 Ready &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;20d v1.16.2 beta.kubernetes.io/arch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amd64,beta.kubernetes.io/os&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux,kubernetes.io/arch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amd64,kubernetes.io/hostname&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;kubernetes2,kubernetes.io/os&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux
&lt;span class=&quot;gp&quot;&gt;kubernetes3 Ready &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;117m v1.16.3 beta.kubernetes.io/arch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amd64,beta.kubernetes.io/os&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux,kubernetes.io/arch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amd64,kubernetes.io/hostname&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;kubernetes3,kubernetes.io/os&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux,namee&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;node3&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Add a new lable “disktype=vhd” to the kubernetes3 node&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl label nodes kubernetes3 &lt;span class=&quot;nv&quot;&gt;disktype&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;vhd
&lt;span class=&quot;go&quot;&gt;node/kubernetes3 labeled

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get nodes &lt;span class=&quot;nt&quot;&gt;--show-labels&lt;/span&gt; 
&lt;span class=&quot;go&quot;&gt;NAME STATUS ROLES AGE VERSION LABELS
kubernetes1 Ready master 20d v1.16.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=kubernetes1,kubernetes.io/os=linux,node-role.kubernetes.io/master=
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;kubernetes2 Ready &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;20d v1.16.2 beta.kubernetes.io/arch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amd64,beta.kubernetes.io/os&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux,kubernetes.io/arch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amd64,kubernetes.io/hostname&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;kubernetes2,kubernetes.io/os&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux
&lt;span class=&quot;gp&quot;&gt;kubernetes3 Ready &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;118m v1.16.3 beta.kubernetes.io/arch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amd64,beta.kubernetes.io/os&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux,disktype&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;vhd,kubernetes.io/arch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amd64,kubernetes.io/hostname&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;kubernetes3,kubernetes.io/os&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux,namee&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;node3&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-2-create-a-pod-and-assign-using-nodeselector&quot;&gt;Step 2: Create a pod and assign using nodeSelector&lt;/h5&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pod_label.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/dc26cbe554bd78b4e17103bcd96d153f.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pod_label.yaml 
&lt;span class=&quot;go&quot;&gt;pod/nginx-pod-label created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pods &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; wide
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;busybox 1/1 Running 3 4h50m 192.168.249.141 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;nginx-pod-label 1/1 Running 0 4m14s 192.168.80.195 kubernetes3 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;web-0 1/1 Running 2 4h25m 192.168.249.139 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;web-1 1/1 Running 2 4h25m 192.168.249.140 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;web-2 1/1 Running 2 4h25m 192.168.249.138 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see the new pod is assinged to kubernetes3 based on nodeSelector label option&lt;/p&gt;
&lt;/blockquote&gt;

&lt;!--kg-card-begin: hr--&gt;
&lt;hr /&gt;
&lt;!--kg-card-end: hr--&gt;
&lt;h3 id=&quot;advance-pod-scheduling&quot;&gt;Advance pod scheduling&lt;/h3&gt;

&lt;p&gt;We can also assing the pod to a specific node using the Node/pod affinity and anti affinity rules.&lt;/p&gt;

&lt;p&gt;Affinity types:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;requiredDuringSchedulingRequiredDuringExecution&lt;/li&gt;
  &lt;li&gt;requiredDuringSchedulingIgnoredDuringExecution&lt;/li&gt;
  &lt;li&gt;preferredDuringSchedulingIgnoredDuringExecution&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Affinity operators:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;In&lt;/li&gt;
  &lt;li&gt;NotIn&lt;/li&gt;
  &lt;li&gt;Exists&lt;/li&gt;
  &lt;li&gt;DoesNotExist&lt;/li&gt;
  &lt;li&gt;Gt&lt;/li&gt;
  &lt;li&gt;Lt&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;node-affinityanti-affinity&quot;&gt;Node Affinity/Anti Affinity&lt;/h3&gt;

&lt;h5 id=&quot;step-1-create-a-pod-with-node-affinity&quot;&gt;Step 1: Create a pod with node affinity&lt;/h5&gt;

&lt;p&gt;Create a pod with node affinity specs and match the lable using matchExpressions spec&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pod_node_affinity.yaml &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/704e4a3ce125a5e66b5b754f9edcd874.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pod_node_affinity.yaml 
&lt;span class=&quot;go&quot;&gt;pod/nginx-pod-nodeaffinity created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pods
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE
busybox 1/1 Running 3 5h17m
nginx-pod-label 1/1 Running 0 31m
nginx-pod-nodeaffinity 0/1 Pending 0 4s
web-0 1/1 Running 2 4h52m
web-1 1/1 Running 2 4h52m
web-2 1/1 Running 2 4h52m&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe pods nginx-pod-nodeaffinity |grep Events: &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; 3
&lt;span class=&quot;go&quot;&gt;Events:
    Type Reason Age From Message
    ---- ------ ---- ---- -------
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;    Warning FailedScheduling &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;default-scheduler 0/3 nodes are available: 3 node&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; didn&lt;span class=&quot;s1&quot;&gt;'t match node selector.
&lt;/span&gt;&lt;span class=&quot;go&quot;&gt;    &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now the pod is failing because there is no node has the match lables&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Lets add a label bandwidth to the kubernetes3 node&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl label nodes kubernetes3 &lt;span class=&quot;nv&quot;&gt;bandwidth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;100GB
&lt;span class=&quot;go&quot;&gt;node/kubernetes3 labeled&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe pods nginx-pod-nodeaffinity |grep Events: &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; 5
&lt;span class=&quot;go&quot;&gt;Events:
    Type Reason Age From Message
    ---- ------ ---- ---- -------
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;    Warning FailedScheduling &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;default-scheduler 0/3 nodes are available: 3 node&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; didn&lt;span class=&quot;s1&quot;&gt;'t match node selector.
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;    Warning FailedScheduling &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;default-scheduler 0/3 nodes are available: 3 node(s) didn'&lt;/span&gt;t match node selector.
&lt;span class=&quot;gp&quot;&gt;    Normal Scheduled &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;default-scheduler Successfully assigned default/nginx-pod-nodeaffinity to kubernetes3&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pods &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; wide
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;busybox 1/1 Running 3 5h23m 192.168.249.141 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;nginx-pod-label 1/1 Running 0 37m 192.168.80.195 kubernetes3 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;nginx-pod-nodeaffinity 1/1 Running 0 6m16s 192.168.80.196 kubernetes3 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;web-0 1/1 Running 2 4h58m 192.168.249.139 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;web-1 1/1 Running 2 4h58m 192.168.249.140 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;web-2 1/1 Running 2 4h59m 192.168.249.138 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;go&quot;&gt;    &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see the node pod is successully assinged to the kubernetes3 node after adding the label&lt;/p&gt;
&lt;/blockquote&gt;

&lt;!--kg-card-begin: hr--&gt;
&lt;hr /&gt;
&lt;!--kg-card-end: hr--&gt;
&lt;h3 id=&quot;pod-affinityanti-affinity&quot;&gt;Pod Affinity/Anti Affinity&lt;/h3&gt;

&lt;p&gt;We can also assing the pod to a specific node using the pod affinity and anti affinity rules.&lt;/p&gt;

&lt;h5 id=&quot;step-1-create-a-pod-with-pod-affinity&quot;&gt;Step 1: Create a pod with pod affinity&lt;/h5&gt;

&lt;p&gt;Create a pod with pod affinity specs and match the lable using matchExpressions spec&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pod_pod_affinity.yaml &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/a4048e59449210e28e4bf66971c8d56a.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pod_pod_affinity.yaml 
&lt;span class=&quot;go&quot;&gt;pod/nginx-pod-podaffinity created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pods
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE
busybox 1/1 Running 4 5h36m
nginx-pod-label 1/1 Running 0 49m
nginx-pod-nodeaffinity 1/1 Running 0 18m
nginx-pod-podaffinity 0/1 Pending 0 4s
web-0 1/1 Running 2 5h10m
web-1 1/1 Running 2 5h10m
web-2 1/1 Running 2 5h11m&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe pods nginx-pod-podaffinity |grep Events: &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; 5 
&lt;span class=&quot;go&quot;&gt;Events:
    Type Reason Age From Message
    ---- ------ ---- ---- -------
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;    Warning FailedScheduling &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;default-scheduler 0/3 nodes are available: 1 node&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; had taints that the pod didn&lt;span class=&quot;s1&quot;&gt;'t tolerate, 2 node(s) didn'&lt;/span&gt;t match pod affinity rules, 2 node&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; didn&lt;span class=&quot;s1&quot;&gt;'t match pod affinity/anti-affinity.
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;    Warning FailedScheduling &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;default-scheduler 0/3 nodes are available: 1 node(s) had taints that the pod didn'&lt;/span&gt;t tolerate, 2 node&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; didn&lt;span class=&quot;s1&quot;&gt;'t match pod affinity rules, 2 node(s) didn'&lt;/span&gt;t match pod affinity/anti-affinity.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now the pod is failing because there is no pod running in any nodes that  has the match lables&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Lets create a new pod with the label configued previously&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pod_label_podaffinity.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/09965427e66db5bc14443f49f2ed2a9d.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl apply &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pod_label_podaffinity.yaml 
&lt;span class=&quot;go&quot;&gt;pod/nginx-pod-web-nginx-backend created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe pods nginx-pod-podaffinity |grep Events: &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; 5 
&lt;span class=&quot;go&quot;&gt;Events:
    Type Reason Age From Message
    ---- ------ ---- ---- -------
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;    Warning FailedScheduling &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;default-scheduler 0/3 nodes are available: 1 node&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; had taints that the pod didn&lt;span class=&quot;s1&quot;&gt;'t tolerate, 2 node(s) didn'&lt;/span&gt;t match pod affinity rules, 2 node&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; didn&lt;span class=&quot;s1&quot;&gt;'t match pod affinity/anti-affinity.
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;    Warning FailedScheduling &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;default-scheduler 0/3 nodes are available: 1 node(s) had taints that the pod didn'&lt;/span&gt;t tolerate, 2 node&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; didn&lt;span class=&quot;s1&quot;&gt;'t match pod affinity rules, 2 node(s) didn'&lt;/span&gt;t match pod affinity/anti-affinity.
&lt;span class=&quot;gp&quot;&gt;    Normal Scheduled &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;default-scheduler Successfully assigned default/nginx-pod-podaffinity to kubernetes3&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pods &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; wide
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;busybox 1/1 Running 4 5h39m 192.168.249.141 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;nginx-pod-label 1/1 Running 0 52m 192.168.80.195 kubernetes3 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;nginx-pod-nodeaffinity 1/1 Running 0 21m 192.168.80.196 kubernetes3 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;nginx-pod-podaffinity 1/1 Running 0 3m2s 192.168.80.197 kubernetes3 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;nginx-pod-web-nginx-backend 1/1 Running 0 14s 192.168.80.198 kubernetes3 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;web-0 1/1 Running 2 5h13m 192.168.249.139 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;web-1 1/1 Running 2 5h13m 192.168.249.140 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;
&lt;span class=&quot;gp&quot;&gt;web-2 1/1 Running 2 5h14m 192.168.249.138 kubernetes2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see only the pod with lable app: web-nginx-backend is created, the previous pod is also created in the same node&lt;/p&gt;
&lt;/blockquote&gt;

&lt;!--kg-card-begin: hr--&gt;
&lt;hr /&gt;
&lt;!--kg-card-end: hr--&gt;
&lt;h3 id=&quot;taints-and-tolerations&quot;&gt;Taints and tolerations&lt;/h3&gt;

&lt;p&gt;Node affinity is a property of pods that attracts them to a set of nodes. Taints are the opposite, they allow a node to repel a set of pods.&lt;/p&gt;

&lt;h5 id=&quot;step-1-create-a-label-to-node-and-assign-pod-using-nodeselector&quot;&gt;Step 1: Create a label to node and assign pod using nodeSelector&lt;/h5&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl label nodes kubernetes4 &lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;highperformance
&lt;span class=&quot;go&quot;&gt;node/kubernetes4 labeled
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get nodes kubernetes4 &lt;span class=&quot;nt&quot;&gt;--show-labels&lt;/span&gt; 
&lt;span class=&quot;go&quot;&gt;NAME STATUS ROLES AGE VERSION LABELS
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;kubernetes4 Ready &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;2m55s v1.16.3 &lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;highperformance,beta.kubernetes.io/arch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amd64,beta.kubernetes.io/os&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux,kubernetes.io/arch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amd64,kubernetes.io/hostname&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;kubernetes4,kubernetes.io/os&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;    vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pod_label_1.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/fb98260bd5405feee85ca565b188933b.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pod_label_1.yaml 
&lt;span class=&quot;go&quot;&gt;pod/nginx-pod-taint created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pod nginx-pod-taint &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; wide
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;nginx-pod-taint 1/1 Running 0 10m 192.168.48.129 kubernetes4 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see the new pod nginx-pod-taint is created and assigned to kubernetes4 node&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-2-create-a-taint&quot;&gt;Step 2: Create a taint&lt;/h5&gt;

&lt;p&gt;Now lets create a taint “NoSchedule” and add to the kubernetes4 node.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl taint nodes kubernetes4 &lt;span class=&quot;nv&quot;&gt;key1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;value1:NoSchedule
&lt;span class=&quot;go&quot;&gt;node/kubernetes4 tainted

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get nodes kubernetes4 &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; yaml |grep &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; taint &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; 3
&lt;span class=&quot;go&quot;&gt;    taints:
    - effect: NoSchedule
    key: key1
    value: value1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-3-create-a-new-pod-and-try-assign-to-kubernetes4&quot;&gt;Step 3: Create a new pod and try assign to kubernetes4&lt;/h5&gt;

&lt;p&gt;Now create a new pod and use nodeSelector to assign to kubernetes4&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pod_label_2.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/4da565b636ec481e4f6e5147b2419a93.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pod_label_2.yaml 
&lt;span class=&quot;go&quot;&gt;pod/nginx-pod-taint-2 created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pods nginx-pod-taint-2 &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; wide
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;nginx-pod-taint-2 0/1 Pending 0 7s &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt; &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe pod nginx-pod-taint-2 |grep &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; events: &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; 5
&lt;span class=&quot;go&quot;&gt;Events:
    Type Reason Age From Message
    ---- ------ ---- ---- -------
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;    Warning FailedScheduling &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;default-scheduler 0/4 nodes are available: 1 node&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; had taints that the pod didn&lt;span class=&quot;s1&quot;&gt;'t tolerate, 3 node(s) didn'&lt;/span&gt;t match node selector.
&lt;span class=&quot;gp&quot;&gt;    Warning FailedScheduling &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;default-scheduler 0/4 nodes are available: 1 node&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; had taints that the pod didn&lt;span class=&quot;s1&quot;&gt;'t tolerate, 3 node(s) didn'&lt;/span&gt;t match node selector.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see the pod creatation if failing due to the taints setting.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-4-update-the-pod-with-tolerations&quot;&gt;Step 4: Update the pod with tolerations&lt;/h5&gt;

&lt;p&gt;Now lets add toleration to the same pod for “NoSchedule” and apply the changes.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pod_label_3.yaml &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/5790929db238b9276d4961d3a91e6a29.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl apply &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pod_label_3.yaml 
&lt;span class=&quot;go&quot;&gt;Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
pod/nginx-pod-taint-2 configured&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe pod nginx-pod-taint-2 |grep &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; events: &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; 5
&lt;span class=&quot;go&quot;&gt;Events:
    Type Reason Age From Message
    ---- ------ ---- ---- -------
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;    Warning FailedScheduling &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;default-scheduler 0/4 nodes are available: 1 node&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; had taints that the pod didn&lt;span class=&quot;s1&quot;&gt;'t tolerate, 3 node(s) didn'&lt;/span&gt;t match node selector.
&lt;span class=&quot;gp&quot;&gt;    Warning FailedScheduling &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;default-scheduler 0/4 nodes are available: 1 node&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; had taints that the pod didn&lt;span class=&quot;s1&quot;&gt;'t tolerate, 3 node(s) didn'&lt;/span&gt;t match node selector.
&lt;span class=&quot;gp&quot;&gt;    Normal Scheduled &amp;lt;unknown&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;default-scheduler Successfully assigned default/nginx-pod-taint-2 to kubernetes4&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pod nginx-pod-taint-2 &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; wide
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;nginx-pod-taint-2 1/1 Running 0 11m 192.168.48.130 kubernetes4 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&amp;lt;none&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see the pod changed from failed to success state and assinged to kubernetes4 node according to the nodeSelector.&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name>Vignesh Ragupathy</name></author><category term="kubernetes" /><category term="linux" /><category term="opensource" /><summary type="html">We can assign the pod to node based on various methods. Lets discuss all the below methods in the post</summary></entry><entry><title type="html">Kubernetes stateful set with local-storage persistent volume</title><link href="https://www.vikki.in/kubernetes-stateful-set-with-local-storage-persistent-volume/" rel="alternate" type="text/html" title="Kubernetes stateful set with local-storage persistent volume" /><published>2019-11-24T08:03:14+05:30</published><updated>2019-11-24T08:03:14+05:30</updated><id>https://www.vikki.in/kubernetes-stateful-set-with-local-storage-persistent-volume</id><content type="html" xml:base="https://www.vikki.in/kubernetes-stateful-set-with-local-storage-persistent-volume/">&lt;p&gt;StatefulSets are similar to deployment contains identical container spec but ensures an order of the deployment. StatefulSets deploy pods in a sequential orders. Each pod as its own identity and is named with a unique ID. In the below post we are going to create a statefulsets and watch the behaviour during deletion of pod, scaling of pod and during update of container image.&lt;/p&gt;

&lt;p&gt;The StatefulSets consist of a headless service, pods and a volume. We are going to use a local-storage volume for statefulsets. It is also common to dynamically allocate storage using  volumeClaimTemplates, but due to some limitation in virtualbox i am using a manual allocation using PersistVolumeClaim.&lt;/p&gt;

&lt;h3 id=&quot;setup&quot;&gt;&lt;strong&gt;Setup&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.&lt;/p&gt;

&lt;!--kg-card-begin: image--&gt;
&lt;figure class=&quot;kg-card kg-image-card&quot;&gt;&lt;img src=&quot;/content/images/2019/11/setup.jpg&quot; class=&quot;kg-image&quot; /&gt;&lt;/figure&gt;
&lt;!--kg-card-end: image--&gt;
&lt;h5 id=&quot;step-1-create-a-persistentvolume-and-persistemvolumeclaim&quot;&gt;Step 1: Create a persistentVolume and persistemVolumeClaim&lt;/h5&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;vim pv.yaml&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/b0fdde697229f150740a079b77458d64.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;vim pv_claim.yaml&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/5f9f6acb132e499ccb80523b170dc815.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pv.yaml 
&lt;span class=&quot;go&quot;&gt;persistentvolume/vikki-pv-volume created

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pv_claim.yaml 
&lt;span class=&quot;go&quot;&gt;persistentvolumeclaim/vikki-pv-volume-claim created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pvc
&lt;span class=&quot;go&quot;&gt;NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE
vikki-pv-volume-claim Bound vikki-pv-volume 1Gi RWO local-storage 4s

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pv
&lt;span class=&quot;go&quot;&gt;NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE
vikki-pv-volume 1Gi RWO Retain Bound default/vikki-pv-volume-claim local-storage 9s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-2-create-a-statefulsets&quot;&gt;Step 2: Create a statefulSets&lt;/h5&gt;

&lt;p&gt;Create a statefulSets and map the PVC created in previous steps. The statefull set consist of the following. -&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Headless service&lt;/li&gt;
  &lt;li&gt;StatefulSets with container details&lt;/li&gt;
  &lt;li&gt;Persistent Volumes&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;vim ss.yaml&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/d04c1473a6dacc90fcc8af2946b54b92.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; ss.yaml 
&lt;span class=&quot;go&quot;&gt;service/nginx created
statefulset.apps/web created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-3-verify-statefulsets&quot;&gt;Step 3: Verify statefulSets&lt;/h5&gt;

&lt;p&gt;Now we can see the statefulsets are created and the respecive pod is created with a sequential unique id.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get statefulsets.apps 
&lt;span class=&quot;go&quot;&gt;NAME READY AGE
web 2/2 6m40s

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pod &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nginx
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE
web-0 1/1 Running 0 15m
web-1 1/1 Running 0 15m&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-4-verify-the-dns-for-statefulsets&quot;&gt;Step 4: Verify the DNS for statefulSets&lt;/h5&gt;

&lt;p&gt;Create a temporary busybox pod and test the dns resolution for each statefulSet pods based on the pod and stateful set name.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl apply &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; https://k8s.io/examples/admin/dns/busybox.yaml
&lt;span class=&quot;go&quot;&gt;pod/busybox created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes2:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;docker ps &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; |grep busybox
&lt;span class=&quot;go&quot;&gt;8e3ba8c16f3e busybox &quot;sleep 3600&quot; 21 seconds ago Up 20 seconds k8s_busybox_busybox_default_454e3e1c-1b41-4f6e-a244-6d89cd8c8379_0
9c890ad85c23 k8s.gcr.io/pause:3.1 &quot;/pause&quot; 28 seconds ago Up 27 seconds k8s_POD_busybox_default_454e3e1c-1b41-4f6e-a244-6d89cd8c8379_0

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes2:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;docker &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-it&lt;/span&gt; k8s_busybox_busybox_default_454e3e1c-1b41-4f6e-a244-6d89cd8c8379_0 /bin/sh
&lt;span class=&quot;gp&quot;&gt;/ #&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;/ #&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;ping web-0
&lt;span class=&quot;go&quot;&gt;ping: bad address 'web-0'
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;/ #&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;ping web-0.nginx
&lt;span class=&quot;go&quot;&gt;PING web-0.nginx (192.168.249.183): 56 data bytes
64 bytes from 192.168.249.183: seq=0 ttl=63 time=0.551 ms
64 bytes from 192.168.249.183: seq=1 ttl=63 time=0.071 ms
^C
--- web-0.nginx ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.071/0.311/0.551 ms

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;/ #&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;ping web-1.nginx
&lt;span class=&quot;go&quot;&gt;PING web-1.nginx (192.168.249.184): 56 data bytes
64 bytes from 192.168.249.184: seq=0 ttl=63 time=0.227 ms
64 bytes from 192.168.249.184: seq=1 ttl=63 time=0.256 ms
^C
--- web-1.nginx ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.227/0.241/0.256 ms
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;/ #&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see both the statefulSets pods resolves for  dns.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-5-verify-the-order-of-pod-creation-on-deletion&quot;&gt;Step 5: Verify the order of pod creation on deletion&lt;/h5&gt;

&lt;p&gt;We can try deleting some pods and see how the new pods are creating&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl delete pod &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nginx
&lt;span class=&quot;go&quot;&gt;pod &quot;web-0&quot; deleted
pod &quot;web-1&quot; deleted
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pod &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nginx
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE
web-0 1/1 Running 0 18m
web-1 1/1 Running 0 18m
web-0 1/1 Terminating 0 19m
web-1 1/1 Terminating 0 19m
web-0 0/1 Terminating 0 19m
web-1 0/1 Terminating 0 19m
web-1 0/1 Terminating 0 19m
web-1 0/1 Terminating 0 19m
web-0 0/1 Terminating 0 19m
web-0 0/1 Terminating 0 19m
web-0 0/1 Pending 0 0s
web-0 0/1 Pending 0 0s
web-0 0/1 ContainerCreating 0 0s
web-0 0/1 ContainerCreating 0 1s
web-0 1/1 Running 0 2s
web-1 0/1 Pending 0 0s
web-1 0/1 Pending 0 0s
web-1 0/1 ContainerCreating 0 0s
web-1 0/1 ContainerCreating 0 1s
web-1 1/1 Running 0 1s
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;^Cvikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see the pod are creating in ascending order preserving the sequence status&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-6-verify-the-order-of-pod-creation-on-scalling&quot;&gt;Step 6: Verify the order of pod creation on scalling&lt;/h5&gt;

&lt;p&gt;Now lets scale up and scale down the statefulset and watch the order of pod creation and deletion&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl scale statefulset &lt;span class=&quot;nt&quot;&gt;--replicas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5 web 
&lt;span class=&quot;go&quot;&gt;statefulset.apps/web scaled&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pod &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nginx
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE
web-0 1/1 Running 0 5m5s
web-1 1/1 Running 0 5m3s
web-2 0/1 Pending 0 0s
web-2 0/1 Pending 0 0s
web-2 0/1 ContainerCreating 0 0s
web-2 0/1 ContainerCreating 0 1s
web-2 1/1 Running 0 1s
web-3 0/1 Pending 0 0s
web-3 0/1 Pending 0 0s
web-3 0/1 ContainerCreating 0 0s
web-3 0/1 ContainerCreating 0 1s
web-3 1/1 Running 0 1s
web-4 0/1 Pending 0 0s
web-4 0/1 Pending 0 0s
web-4 0/1 ContainerCreating 0 1s
web-4 0/1 ContainerCreating 0 2s
web-4 1/1 Running 0 3s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl scale statefulset &lt;span class=&quot;nt&quot;&gt;--replicas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3 web 
&lt;span class=&quot;go&quot;&gt;statefulset.apps/web scaled&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pod &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nginx
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE
web-0 1/1 Running 0 5m44s
web-1 1/1 Running 0 5m42s
web-2 1/1 Running 0 19s
web-3 1/1 Running 0 18s
web-4 1/1 Running 0 17s
web-4 1/1 Terminating 0 40s
web-4 0/1 Terminating 0 42s
web-4 0/1 Terminating 0 47s
web-4 0/1 Terminating 0 47s
web-3 1/1 Terminating 0 48s
web-3 0/1 Terminating 0 49s
web-3 0/1 Terminating 0 58s
web-3 0/1 Terminating 0 58s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see from the above output the sequential order is preserved&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-6-verify-the-order-of-pod-creation-on-update&quot;&gt;Step 6: Verify the order of pod creation on update&lt;/h5&gt;

&lt;p&gt;Now lets update the image in the statefulset and watch for the pod creation and deletion&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get statefulsets.apps web &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; yaml |grep updateStrategy &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; 3
&lt;span class=&quot;go&quot;&gt;    updateStrategy:
    rollingUpdate:
        partition: 0
    type: RollingUpdate
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Current statefulsets has the updatestrategy of type “&lt;em&gt;RollingUpdate&lt;/em&gt;”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Lets modify the container image to a different version&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;image statefulset web &lt;span class=&quot;nv&quot;&gt;nginx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;k8s.gcr.io/nginx-slim:0.9
&lt;span class=&quot;go&quot;&gt;statefulset.apps/web image updated&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pod &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nginx
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE
web-0 1/1 Running 0 9m57s
web-1 1/1 Running 0 9m55s
web-2 1/1 Running 0 4m32s
web-2 1/1 Terminating 0 5m29s
web-2 0/1 Terminating 0 5m30s
web-2 0/1 Terminating 0 5m39s
web-2 0/1 Terminating 0 5m39s
web-2 0/1 Pending 0 0s
web-2 0/1 Pending 0 0s
web-2 0/1 ContainerCreating 0 0s
web-2 0/1 ContainerCreating 0 1s
web-2 1/1 Running 0 32s
web-1 1/1 Terminating 0 11m
web-1 0/1 Terminating 0 11m
web-1 0/1 Terminating 0 11m
web-1 0/1 Terminating 0 11m
web-1 0/1 Pending 0 0s
web-1 0/1 Pending 0 0s
web-1 0/1 ContainerCreating 0 0s
web-1 0/1 ContainerCreating 0 1s
web-1 1/1 Running 0 2s
web-0 1/1 Terminating 0 11m
web-0 0/1 Terminating 0 11m
web-0 0/1 Terminating 0 11m
web-0 0/1 Terminating 0 11m
web-0 0/1 Pending 0 0s
web-0 0/1 Pending 0 0s
web-0 0/1 ContainerCreating 0 0s
web-0 0/1 ContainerCreating 0 1s
web-0 1/1 Running 0 2s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see from the above output the sequential order is preserved&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name>Vignesh Ragupathy</name></author><category term="kubernetes" /><category term="linux" /><category term="opensource" /><summary type="html">StatefulSets are similar to deployment contains identical container spec but ensures an order of the deployment. StatefulSets deploy pods in a sequential orders. Each pod as its own identity and is named with a unique ID. In the below post we are going to create a statefulsets and watch the behaviour during deletion of pod, scaling of pod and during update of container image.</summary></entry><entry><title type="html">Creating persistent local-storage volume in Kubernetes</title><link href="https://www.vikki.in/creating-persistent-local-storage-volume-in-kubernetes/" rel="alternate" type="text/html" title="Creating persistent local-storage volume in Kubernetes" /><published>2019-11-23T14:12:38+05:30</published><updated>2019-11-23T14:12:38+05:30</updated><id>https://www.vikki.in/creating-persistent-local-storage-volume-in-kubernetes</id><content type="html" xml:base="https://www.vikki.in/creating-persistent-local-storage-volume-in-kubernetes/">&lt;p&gt;PersistentVolume and PersistentVolumeClaim in kubernetes provides a way to allocate storage for the pods. Kubernetes PV supports different types of storage. Now here in the below post we are going to use storage-class &lt;strong&gt;local-storage&lt;/strong&gt; and watch the behaviour for different reclaimpolicy.&lt;/p&gt;

&lt;h3 id=&quot;setup&quot;&gt;&lt;strong&gt;Setup&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.&lt;/p&gt;

&lt;!--kg-card-begin: image--&gt;
&lt;figure class=&quot;kg-card kg-image-card&quot;&gt;&lt;img src=&quot;/content/images/2019/11/Screenshot-from-2019-11-23-11-56-54-2.png&quot; class=&quot;kg-image&quot; /&gt;&lt;/figure&gt;
&lt;!--kg-card-end: image--&gt;
&lt;h5 id=&quot;step-1-create-a-directory-in-one-for-the-node-and-add-a-file&quot;&gt;Step 1: Create a directory in one for the node and add a file&lt;/h5&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes2:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; /pvdir
&lt;span class=&quot;gp&quot;&gt;root@kubernetes2:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Hello world!&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /pvdir/index.html 
&lt;span class=&quot;gp&quot;&gt;root@kubernetes2:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /pvdir/index.html 
&lt;span class=&quot;go&quot;&gt;Hello world!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-2-get-the-label-of-the-node&quot;&gt;Step 2: Get the label of the node&lt;/h5&gt;

&lt;p&gt;We need to get the label of the node where the directory is created.This we need to configure  in the nodeAffinity specs in order to properly stick the pod to respective node where the local volume is present.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get nodes &lt;span class=&quot;nt&quot;&gt;--show-labels&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;NAME STATUS ROLES AGE VERSION LABELS
kubernetes1 Ready master 19d v1.16.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=kubernetes1,kubernetes.io/os=linux,node-role.kubernetes.io/master=
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;kubernetes2 Ready &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;19d v1.16.2 beta.kubernetes.io/arch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amd64,beta.kubernetes.io/os&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux,kubernetes.io/arch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;amd64,kubernetes.io/hostname&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;kubernetes2,kubernetes.io/os&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-3-create-a-persistent-volumepv&quot;&gt;Step 3: Create a persistent volume(PV)&lt;/h5&gt;

&lt;p&gt;Create a PV and map the local storage director and configure the label in the node selector&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pv.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/b0fdde697229f150740a079b77458d64.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pv.yaml 
&lt;span class=&quot;go&quot;&gt;persistentvolume/vikki-pv-volume created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-4-verify-the-pv-status&quot;&gt;Step 4: Verify the PV status&lt;/h5&gt;

&lt;p&gt;Verify the PV status. It is currently configured with access type &lt;strong&gt;RWO&lt;/strong&gt; and reclaim policy as &lt;strong&gt;Delete&lt;/strong&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pv
&lt;span class=&quot;go&quot;&gt;NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE
vikki-pv-volume 1Gi RWO Delete Available local-storage 14s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-5-create-a-persistent-volume-claimpvc&quot;&gt;Step 5: Create a persistent volume claim(PVC)&lt;/h5&gt;

&lt;p&gt;Create a PVC and map the above created PV&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pv_claim.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/5f9f6acb132e499ccb80523b170dc815.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pv_claim.yaml 
&lt;span class=&quot;go&quot;&gt;persistentvolumeclaim/vikki-pv-volume-claim created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-6-verify-the-pvc-status&quot;&gt;Step 6: Verify the PVC status&lt;/h5&gt;

&lt;p&gt;Verify the PVC and PV status. Now we can see the status changes from &lt;em&gt;Available&lt;/em&gt; to &lt;em&gt;Bound.&lt;/em&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pvc
&lt;span class=&quot;go&quot;&gt;NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE
vikki-pv-volume-claim Bound vikki-pv-volume 1Gi RWO local-storage 8s
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pv
&lt;span class=&quot;go&quot;&gt;NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE
vikki-pv-volume 1Gi RWO Delete Bound default/vikki-pv-volume-claim local-storage 3m59s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-7-create-a-pod-and-map-the-pvc&quot;&gt;Step 7: Create a pod and map the PVC&lt;/h5&gt;

&lt;p&gt;Create a pod and map the volumes as below&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl run &lt;span class=&quot;nt&quot;&gt;--image&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nginx nginx-pod &lt;span class=&quot;nt&quot;&gt;--generator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;run-pod/v1 &lt;span class=&quot;nt&quot;&gt;--dry-run&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; yaml &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; pod.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pod.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/76f42e185c516284f0babbdc3b67cd1a.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pod.yaml 
&lt;span class=&quot;go&quot;&gt;pod/nginx-pod created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-8-verify-the-pod-status-and-volume-inside&quot;&gt;Step 8: Verify the pod status and volume inside&lt;/h5&gt;

&lt;p&gt;Verify the status of the new pod and check the volume is mounted inside the container&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pods
&lt;span class=&quot;go&quot;&gt;NAME READY STATUS RESTARTS AGE
fluentd-elasticsearch-bwhfx 0/1 ImagePullBackOff 0 4h3m
fluentd-elasticsearch-pvlpv 0/1 ImagePullBackOff 0 4h3m
nginx-85ff79dd56-zqllr 1/1 Running 1 5h51m
nginx-pod 1/1 Running 0 10s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes2:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;docker ps &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; |grep nginx-pod
&lt;span class=&quot;go&quot;&gt;e142048a048f nginx &quot;nginx -g 'daemon of…&quot; 20 seconds ago Up 20 seconds k8s_nginx-pod_nginx-pod_default_b6b900bb-b214-4b96-bc90-18b2358ee225_0
df59f401a38a k8s.gcr.io/pause:3.1 &quot;/pause&quot; 26 seconds ago Up 25 seconds k8s_POD_nginx-pod_default_b6b900bb-b214-4b96-bc90-18b2358ee225_0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;root@kubernetes2:~#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;docker &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-it&lt;/span&gt; k8s_nginx-pod_nginx-pod_default_b6b900bb-b214-4b96-bc90-18b2358ee225_0 &lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /usr/share/nginx/html/index.html
&lt;span class=&quot;go&quot;&gt;Hello world!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see the directory from the PV is mounted in the pod and the files created are present&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;verify-reclaim-policybelow-steps-are-optional&quot;&gt;Verify reclaim policy(Below steps are Optional)&lt;/h2&gt;

&lt;h5 id=&quot;step-9-delete-pvc-and-verify-pv&quot;&gt;Step 9: Delete PVC and verify PV&lt;/h5&gt;

&lt;p&gt;Now delete the pod and PVC and verify the status of PV&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl delete pod nginx-pod
&lt;span class=&quot;go&quot;&gt;pod &quot;nginx-pod&quot; deleted&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl delete pvc vikki-pv-volume-claim 
&lt;span class=&quot;go&quot;&gt;persistentvolumeclaim &quot;vikki-pv-volume-claim&quot; deleted&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pv
&lt;span class=&quot;go&quot;&gt;NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE
vikki-pv-volume 1Gi RWO Delete Failed default/vikki-pv-volume-claim local-storage 5m30s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see the staus of PV is automaticall changed to &lt;strong&gt;Failed.&lt;/strong&gt; This is due the the reclaim policy &lt;strong&gt;Delete&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-10-optional--try-recreate-pvc&quot;&gt;Step 10: (Optional ) Try recreate PVC&lt;/h5&gt;

&lt;p&gt;We can optionally try recreating the PVC volume and verify the status&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pv_claim.yaml 
&lt;span class=&quot;go&quot;&gt;persistentvolumeclaim/vikki-pv-volume-claim created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pv
&lt;span class=&quot;go&quot;&gt;NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE
vikki-pv-volume 1Gi RWO Delete Failed default/vikki-pv-volume-claim local-storage 5m57s
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pvc
&lt;span class=&quot;go&quot;&gt;NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE
vikki-pv-volume-claim Pending local-storage 2m10s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can see the status of PV is still &lt;strong&gt;Failed&lt;/strong&gt; and the PVC always in &lt;strong&gt;Pending&lt;/strong&gt; and never creates&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;step-11-delete-and-create-pv-with-reclaim-policy-as-retain&quot;&gt;Step 11: Delete and create PV with reclaim policy as retain&lt;/h5&gt;

&lt;p&gt;Now lets clean up all PV and PVC and recreate PV with reclaim policy set as “Retain”&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl delete pvc vikki-pv-volume-claim 
&lt;span class=&quot;go&quot;&gt;persistentvolumeclaim &quot;vikki-pv-volume-claim&quot; deleted

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl delete pv vikki-pv-volume 
&lt;span class=&quot;go&quot;&gt;persistentvolume &quot;vikki-pv-volume&quot; deleted&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim pv.yaml
&lt;span class=&quot;go&quot;&gt;persistentVolumeReclaimPolicy: Retain&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pv.yaml 
&lt;span class=&quot;go&quot;&gt;persistentvolume/vikki-pv-volume created
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pv_claim.yaml 
&lt;span class=&quot;go&quot;&gt;persistentvolumeclaim/vikki-pv-volume-claim created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pvc,pv
&lt;span class=&quot;go&quot;&gt;NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE
persistentvolumeclaim/vikki-pv-volume-claim Bound vikki-pv-volume 1Gi RWO local-storage 99s

NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE
persistentvolume/vikki-pv-volume 1Gi RWO Retain Bound default/vikki-pv-volume-claim local-storage 118s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h5 id=&quot;step-12-delete-the-pvc-and-verify-the-status-of-pv&quot;&gt;Step 12: Delete the PVC and verify the status of PV&lt;/h5&gt;

&lt;p&gt;Now lets delete the PVC and verify the status of the PV&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl delete pvc vikki-pv-volume-claim 
&lt;span class=&quot;go&quot;&gt;persistentvolumeclaim &quot;vikki-pv-volume-claim&quot; deleted&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pv
&lt;span class=&quot;go&quot;&gt;NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE
vikki-pv-volume 1Gi RWO Retain Released default/vikki-pv-volume-claim local-storage 2m11s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see the status of PV changes to “Released” instead of “Failed” due to the reclaim policy “Retain”&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name>Vignesh Ragupathy</name></author><category term="kubernetes" /><category term="linux" /><category term="opensource" /><summary type="html">PersistentVolume and PersistentVolumeClaim in kubernetes provides a way to allocate storage for the pods. Kubernetes PV supports different types of storage. Now here in the below post we are going to use storage-class local-storage and watch the behaviour for different reclaimpolicy.</summary></entry><entry><title type="html">Rolling updates and update strategy in Kubernetes daemonsets</title><link href="https://www.vikki.in/rolling-updates-and-rollbacks-in-kubernetes/" rel="alternate" type="text/html" title="Rolling updates and update strategy in Kubernetes daemonsets" /><published>2019-11-23T08:54:21+05:30</published><updated>2019-11-23T08:54:21+05:30</updated><id>https://www.vikki.in/rolling-updates-and-rollbacks-in-kubernetes</id><content type="html" xml:base="https://www.vikki.in/rolling-updates-and-rollbacks-in-kubernetes/">&lt;p&gt;Daemonset ensures that all the nodes run a copy of a pod. It can be used for running storage/monitoring daemons like glusterd,Prometheus etc. Now in this post we are going to see how to create a daemonset and do an image update. We are also going to perform different update strategy and watch the behaviour of damonset updates.&lt;/p&gt;

&lt;h3 id=&quot;setup&quot;&gt;&lt;strong&gt;Setup&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;I am using the Virtualbox(running in Ubuntu 18.04 physical machine) for this entire setup . The physical machine is Dell inspiron laptop with 12GB RAM , Intel® Core™ i7-6500U CPU @ 2.50GHz × 4 and 512GB SSD hardisk.&lt;/p&gt;

&lt;!--kg-card-begin: image--&gt;
&lt;figure class=&quot;kg-card kg-image-card&quot;&gt;&lt;img src=&quot;/content/images/2019/11/Screenshot-from-2019-11-23-11-56-54-1.png&quot; class=&quot;kg-image&quot; /&gt;&lt;/figure&gt;
&lt;!--kg-card-end: image--&gt;
&lt;h3 id=&quot;step-1-create-a-daemon-set&quot;&gt;Step 1: Create a daemon set&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; ds.yaml 
&lt;span class=&quot;go&quot;&gt;daemonset.apps/fluentd-elasticsearch created&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/467337d30e6018fae4d33af6d762f36d.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get ds
&lt;span class=&quot;go&quot;&gt;NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;fluentd-elasticsearch 2 2 2 2 2 &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;5s&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;step-2-verify-the-image-version-and-updatestrategy-of-the-daemonset&quot;&gt;Step 2: Verify the image version and updateStrategy of the daemonset&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe ds fluentd-elasticsearch |grep Image
&lt;span class=&quot;go&quot;&gt;    Image: quay.io/fluentd_elasticsearch/fluentd:v2.5.2

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get ds fluentd-elasticsearch &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; yaml |grep &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; 3 &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; updateStrategy
&lt;span class=&quot;go&quot;&gt;    updateStrategy:
    rollingUpdate:
        maxUnavailable: 1
    type: RollingUpdate

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pod fluentd-elasticsearch-
&lt;span class=&quot;go&quot;&gt;fluentd-elasticsearch-7ds49 fluentd-elasticsearch-qh8n8  
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe pod fluentd-elasticsearch-7ds49 |grep Image:
&lt;span class=&quot;go&quot;&gt;    Image: quay.io/fluentd_elasticsearch/fluentd:v2.5.2
    &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;The daemonset has a image version of “ &lt;strong&gt;2.5.2”&lt;/strong&gt; and updateStrategy “ &lt;strong&gt;RollingUpdate&lt;/strong&gt;”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;step-3-update-the-daemon-set-container-image-to-a-different-version-say-252&quot;&gt;Step 3: Update the daemon set container image to a different version say “2.5.2”&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;image ds fluentd-elasticsearch fluentd-elasticsearch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;quay.io/fluentd_elasticsearch/fluentd:v2.5.1
&lt;span class=&quot;go&quot;&gt;daemonset.apps/fluentd-elasticsearch image updated&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;step-4--verify-the-image-version-is-updated-in-daemonset-level-also-in-pod-level&quot;&gt;step 4 : Verify the image version is updated in daemonset level also in pod level&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe ds fluentd-elasticsearch |grep Image
&lt;span class=&quot;go&quot;&gt;    Image: quay.io/fluentd_elasticsearch/fluentd:v2.5.1

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe pod fluentd-elasticsearch-
&lt;span class=&quot;go&quot;&gt;fluentd-elasticsearch-qh8n8 fluentd-elasticsearch-x2f57  
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe pod fluentd-elasticsearch-qh8n8 |grep Image:
&lt;span class=&quot;go&quot;&gt;    Image: quay.io/fluentd_elasticsearch/fluentd:v2.5.1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see , as soon as the daemonset image is updated , the pod image also gets updated. This is because of the updateStrategy set as &lt;strong&gt;RollingUpdate&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;step-5-now-lets-change-the-updatestrategy-to-ondelete-and-watch-the-behaviour&quot;&gt;Step 5: Now lets change the updateStrategy to OnDelete and watch the behaviour&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get ds fluentd-elasticsearch &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; yaml &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; ds_new.yaml 
&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;vim ds_new.yaml 
&lt;span class=&quot;go&quot;&gt;    
    
    &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;!--kg-card-begin: html--&gt;
&lt;script src=&quot;https://gist.github.com/vignesh88/573453ca14d2e79e02f3cfe6c7a3ef20.js&quot;&gt;&lt;/script&gt;
&lt;!--kg-card-end: html--&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl apply &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; ds_new.yaml 
&lt;span class=&quot;go&quot;&gt;Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
daemonset.apps/fluentd-elasticsearch configured&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe ds fluentd-elasticsearch |grep Image
&lt;span class=&quot;go&quot;&gt;    Image: quay.io/fluentd_elasticsearch/fluentd:v2.5.1

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get ds fluentd-elasticsearch &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; yaml |grep &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; 3 &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; updateStrategy
&lt;span class=&quot;go&quot;&gt;--
    updateStrategy:
    rollingUpdate:
        maxUnavailable: 1
    type: OnDelete

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe pod fluentd-elasticsearch-qh8n8 |grep Image:
&lt;span class=&quot;go&quot;&gt;    Image: quay.io/fluentd_elasticsearch/fluentd:v2.5.2
    &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;The udpate strategy is changed to &lt;strong&gt;OnDelete&lt;/strong&gt; and the version in &lt;strong&gt;2.5.2&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;step-6-lets-change-the-image-to-different-version&quot;&gt;Step 6: Lets change the image to different version&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;image ds fluentd-elasticsearch fluentd-elasticsearch&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;quay.io/fluentd_elasticsearch/fluentd:v2.5.0
&lt;span class=&quot;go&quot;&gt;daemonset.apps/fluentd-elasticsearch image updated&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;step-7-verify-the-image-version-in-daemonset-and-pod&quot;&gt;Step 7: Verify the image version in daemonset and pod&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe ds fluentd-elasticsearch |grep Image
&lt;span class=&quot;go&quot;&gt;    Image: quay.io/fluentd_elasticsearch/fluentd:v2.5.0

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe pod fluentd-elasticsearch-qh8n8 |grep Image:
&lt;span class=&quot;go&quot;&gt;    Image: quay.io/fluentd_elasticsearch/fluentd:v2.5.2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see the image version on Daemonset is updated , but the pod is still running in the older version&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;step-8-lets-delete-the-pod-and-wait-for-the-new-pods-to-be-created-and-verify-the-image-version-in-new-pod&quot;&gt;Step 8: Lets delete the pod and wait for the new pods to be created and verify the image version in new pod&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl delete pod fluentd-elasticsearch-
&lt;span class=&quot;go&quot;&gt;fluentd-elasticsearch-qh8n8 fluentd-elasticsearch-x2f57  

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl delete pod fluentd-elasticsearch-qh8n8 fluentd-elasticsearch-x2f57
&lt;span class=&quot;go&quot;&gt;pod &quot;fluentd-elasticsearch-qh8n8&quot; deleted
pod &quot;fluentd-elasticsearch-x2f57&quot; deleted&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pod fluentd-elasticsearch-
&lt;span class=&quot;go&quot;&gt;fluentd-elasticsearch-89g44 fluentd-elasticsearch-mf5f9  

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl get pod fluentd-elasticsearch-
&lt;span class=&quot;go&quot;&gt;fluentd-elasticsearch-89g44 fluentd-elasticsearch-mf5f9  

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;vikki@kubernetes1:~$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;kubectl describe pod fluentd-elasticsearch-89g44 |grep Image:
&lt;span class=&quot;go&quot;&gt;    Image: quay.io/fluentd_elasticsearch/fluentd:v2.5.0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;Now we can see the version is automatically updated on the new pod only after delete.&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name>Vignesh Ragupathy</name></author><category term="kubernetes" /><category term="linux" /><category term="opensource" /><summary type="html">Daemonset ensures that all the nodes run a copy of a pod. It can be used for running storage/monitoring daemons like glusterd,Prometheus etc. Now in this post we are going to see how to create a daemonset and do an image update. We are also going to perform different update strategy and watch the behaviour of damonset updates.</summary></entry></feed>